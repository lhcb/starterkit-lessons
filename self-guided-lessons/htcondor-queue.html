

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Using the queue command &mdash; LHCb Starterkit Lessons  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/panels.css" type="text/css" />
  <link rel="stylesheet" href="../_static/starterkit.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/panels.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Creating a grid proxy without LbScripts" href="local-grid-proxy.html" />
    <link rel="prev" title="More submit file options" href="htcondor-more-options.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> LHCb Starterkit Lessons
          

          
            
            <img src="../_static/starterkit.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../first-analysis-steps/README.html">First Analysis Steps</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../first-analysis-steps/prerequisites.html">Pre-workshop checklist</a></li>
<li class="toctree-l2"><a class="reference internal" href="../first-analysis-steps/introduction-to-course.html">Goals of the course</a></li>
<li class="toctree-l2"><a class="reference internal" href="../first-analysis-steps/physics-at-lhcb.html">Physics at LHCb</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../first-analysis-steps/physics-at-lhcb.html#the-reconstruction">The reconstruction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../first-analysis-steps/physics-at-lhcb.html#building-decay-candidates">Building decay candidates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../first-analysis-steps/physics-at-lhcb.html#building-more-complex-decays">Building more complex decays</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../first-analysis-steps/dataflow.html">The LHCb data flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../first-analysis-steps/run-2-data-flow.html">Changes to the data flow in Run 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../first-analysis-steps/davinci.html">An introduction to LHCb Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="../first-analysis-steps/bookkeeping.html">Finding data in the Bookkeeping</a></li>
<li class="toctree-l2"><a class="reference internal" href="../first-analysis-steps/files-from-grid.html">Downloading a file from the grid</a></li>
<li class="toctree-l2"><a class="reference internal" href="../first-analysis-steps/interactive-dst.html">Interactively exploring a DST</a></li>
<li class="toctree-l2"><a class="reference internal" href="../first-analysis-steps/minimal-dv-job.html">Running a minimal DaVinci job locally</a></li>
<li class="toctree-l2"><a class="reference internal" href="../first-analysis-steps/loki-functors.html">Fun with LoKi Functors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../first-analysis-steps/add-tupletools.html">TupleTools and branches</a></li>
<li class="toctree-l2"><a class="reference internal" href="../first-analysis-steps/decay-tree-fitter.html">How do I use DecayTreeFitter?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../first-analysis-steps/analysis-productions.html">Analysis Productions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../first-analysis-steps/analysis-productions.html#monitoring-productions">Monitoring productions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../first-analysis-steps/analysis-productions.html#creating-your-own-production">Creating your own production</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../first-analysis-steps/analysis-productions.html#testing-your-production-locally">Testing your production locally</a></li>
<li class="toctree-l4"><a class="reference internal" href="../first-analysis-steps/analysis-productions.html#creating-a-merge-request">Creating a merge request</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../first-analysis-steps/davinci-grid.html">Running DaVinci on the grid</a></li>
<li class="toctree-l2"><a class="reference internal" href="../first-analysis-steps/split-jobs.html">Splitting a job into subjobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../first-analysis-steps/ganga-data.html">More Ganga</a></li>
<li class="toctree-l2"><a class="reference internal" href="../first-analysis-steps/eos-storage.html">Storing large files on EOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../first-analysis-steps/lhcb-dev.html">Developing LHCb Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="../first-analysis-steps/asking-questions.html">Asking good questions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../first-analysis-steps/ecgd.html">Early career, gender and diversity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../first-analysis-steps/contributing-lesson.html">Contribute to this lesson</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../second-analysis-steps/README.html">Second Analysis Steps</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/lb-git.html">Using git to develop LHCb software</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/building-decays.html">Building your own decay</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/building-decays-part0.html">The Selection Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/building-decays-part1.html">A Historical Approach</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/building-decays-part2.html">Modern Selection Framework</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/fixing-errors.html">What to do when something fails</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/rerun-stripping.html">Run a different stripping line on simulated data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/switch-mass-hypo.html">Replace a mass hypothesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/filter-in-trees.html">Reuse particles from a decay tree</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/simulation.html">The simulation framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-intro.html">What is Gauss?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-running-gauss.html">Which option files to use and how to run Gauss</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-running-gauss.html#running-gauss-and-create-a-generator-only-sample">Running Gauss and create a generator-only sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-running-gauss.html#make-an-ntuple">Make an nTuple</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-dkfiles.html">Controlling the decay: DecFiles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-gencuts.html">Modifying the decay</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/simulation-gencuts.html#adding-a-decay-channel">Adding a decay channel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/simulation-gencuts.html#generator-level-cuts">Generator level cuts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/simulation-gencuts.html#removing-the-generator-cuts">Removing the generator cuts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/simulation-gencuts.html#modifying-the-cut-tool">Modifying the cut tool</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-advanced-dkfiles.html">Advanced: Modifying the decay</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-advanced-dkfiles.html#multi-body-decays">3+ multi-body decays</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-advanced-dkfiles.html#cocktail-decays">Cocktail decays</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-advanced-dkfiles.html#final-state-radiation">Final state radiation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-advanced-dkfiles.html#changing-particle-masses-lifetimes-widths">Changing particle masses / lifetimes/ widths</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-advanced-dkfiles.html#finding-constants-used-in-an-existing-mc-sample-masses-lifetimes-etc">Finding Constants Used in an Existing MC Sample (Masses/Lifetimes/etc)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-fastsim.html">Why fast simulation is crucial</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/simulation-fastsim.html#speeding-up-the-detector-simulation">Speeding up the detector simulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/simulation-fastsim.html#speeding-up-the-generation">Speeding up the generation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/hlt-intro.html">HLT intro</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/hlt-intro.html#add-trigger-information-to-your-ntuple">Add trigger information to your ntuple</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/hlt-intro.html#exploring-a-tck-list-of-trigger-lines">Exploring a TCK: List of trigger lines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/hlt-intro.html#add-trigger-information-to-your-ntuple-continued">Add trigger information to your ntuple, continued</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/hlt-intro.html#add-tistos-information-to-your-ntuple">Add TISTOS information to your ntuple</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/hlt-intro.html#exploring-a-tck-properties-of-trigger-lines">Exploring a TCK: Properties of trigger lines</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/tistos-diy.html">TisTos DIY</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/ganga-scripting.html">Scripting Ganga</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/ganga-scripting.html#defining-jobs-with-scripts">Defining jobs with scripts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/ganga-scripting.html#adding-helpers-functions">Adding helpers functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/managing-files-with-ganga.html">Managing files in Ganga</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/analysis-automation-snakemake.html">Analysis automation with snakemake</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/analysis-automation-snakemake.html#motivation">Motivation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/analysis-automation-snakemake.html#documentation-and-installation">Documentation and installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/analysis-automation-snakemake.html#tutorial">Tutorial</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/analysis-automation-snakemake.html#usage-and-basic-behaviour">Usage and basic behaviour</a></li>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/analysis-automation-snakemake.html#sub-labels">Sub-labels</a></li>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/analysis-automation-snakemake.html#run-and-shell">Run and shell</a></li>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/analysis-automation-snakemake.html#config-files">Config files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/analysis-automation-snakemake.html#includes">Includes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="README.html">Self guided lessons</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="htcondor.html">Batch submission using HTCondor</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="htcondor-first-job.html">Submitting a simple job</a><ul>
<li class="toctree-l4"><a class="reference internal" href="htcondor-first-job.html#tracking-your-jobs">Tracking your jobs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="htcondor-more-options.html">More submit file options</a><ul>
<li class="toctree-l4"><a class="reference internal" href="htcondor-more-options.html#input-files">Input files</a></li>
<li class="toctree-l4"><a class="reference internal" href="htcondor-more-options.html#output-files">Output files</a></li>
<li class="toctree-l4"><a class="reference internal" href="htcondor-more-options.html#arguments">Arguments</a></li>
<li class="toctree-l4"><a class="reference internal" href="htcondor-more-options.html#resources-and-requirements">Resources and Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="htcondor-more-options.html#notifications">Notifications</a></li>
</ul>
</li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Using the queue command</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#more-on-variables">More on variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#other-ways-to-queue">Other ways to queue</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mixing-options-and-variables">Mixing options and variables</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="htcondor.html#system-architecture">System architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="htcondor.html#other-useful-resources">Other useful resources</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="local-grid-proxy.html">Creating a grid proxy without LbScripts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="local-grid-proxy.html#installation">Installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="local-grid-proxy.html#macos-with-homebrew">macOS with homebrew</a></li>
<li class="toctree-l4"><a class="reference internal" href="local-grid-proxy.html#ubuntu">Ubuntu</a></li>
<li class="toctree-l4"><a class="reference internal" href="local-grid-proxy.html#centos">CentOS</a></li>
<li class="toctree-l4"><a class="reference internal" href="local-grid-proxy.html#arch-linux">Arch Linux</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="local-grid-proxy.html#getting-the-required-files-and-certificates">Getting the required files and certificates</a></li>
<li class="toctree-l3"><a class="reference internal" href="local-grid-proxy.html#creating-a-proxy">Creating a proxy</a></li>
<li class="toctree-l3"><a class="reference internal" href="local-grid-proxy.html#managing-the-proxy">Managing the proxy</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../CONTRIBUTING.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../CONTRIBUTING.html#dependencies">Dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../CONDUCT.html">Contributor Code of Conduct</a></li>
<li class="toctree-l3"><a class="reference internal" href="../LICENSE.html">Instructional Material</a></li>
<li class="toctree-l3"><a class="reference internal" href="../LICENSE.html#software">Software</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">External links:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://hsf-training.github.io/analysis-essentials/">Analysis essentials</a></li>
<li class="toctree-l1"><a class="reference external" href="https://cern.ch/lhcb-core-doc/">LHCb Core documentation</a></li>
<li class="toctree-l1"><a class="reference external" href="https://lhcb.github.io/glossary/">LHCb glossary</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">LHCb Starterkit Lessons</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="README.html">Self guided lessons</a> &raquo;</li>
        
          <li><a href="htcondor.html">Batch submission using HTCondor</a> &raquo;</li>
        
      <li>Using the queue command</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/lhcb/starterkit-lessons/blob/master/self-guided-lessons/htcondor-queue.md" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="using-the-queue-command">
<h1>Using the queue command<a class="headerlink" href="#using-the-queue-command" title="Permalink to this headline">¶</a></h1>
<div class="panel panel-objectives docutils container">
<div class="panel-header open docutils container">
<p id="learning-objectives"><i class="fa fa-line-chart"></i> Learning Objectives</p>
</div>
<div class="panel-body docutils container">
<ul class="simple">
<li><p>Be able to submit multiple jobs at once by adding to the <code class="docutils literal notranslate"><span class="pre">queue</span></code> command</p></li>
<li><p>Be able to use variables in a submit file to automatically change the behaviour of each job</p></li>
<li><p>Learn some different options for queuing multiple jobs</p></li>
</ul>
</div>
</div>
<p>So far, we have ended all of our submit files by simply writing <code class="docutils literal notranslate"><span class="pre">queue</span></code> to tell HTCondor to schedule a single execution of the job that we defined. However, it wouldn’t be batch computing without being able to submit large numbers of jobs at once!</p>
<p>Let’s create another simple job using a python script, <code class="docutils literal notranslate"><span class="pre">my_script.py</span></code>. We want both file input and output - for this example, let’s have it reverse the input text, and save it to a new file. We also want to specify both files as arguments. Such a script might look something like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import argparse
parser = argparse.ArgumentParser()
parser.add_argument(&#39;inputfile&#39;, help=&#39;Specify an input file&#39;, type=str)
parser.add_argument(&#39;outputfile&#39;, help=&#39;Specify an output file&#39;, type=str)
args = parser.parse_args()

f_in = open(args.inputfile, &#39;r&#39;)
f_out = open(args.outputfile, &#39;w+&#39;)
f_out.write( &#39;&#39;.join( reversed(f_in.read()) ) )
</pre></div>
</div>
<p>As before, we’ll use an executable shell script <code class="docutils literal notranslate"><span class="pre">exec.sh</span></code> as a wrapper:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#!/bin/bash
python3 my_script.py &quot;$@&quot;
</pre></div>
</div>
<p>And finally, the all-important submit file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>executable  = exec.sh
universe    = vanilla
arguments   = data.txt result.txt
+JobFlavour = &quot;espresso&quot;

transfer_input_files = my_script.py, input/data.txt
transfer_output_files = result.txt
should_transfer_files = IF_NEEDED
when_to_transfer_output = ON_EXIT

output      = output.out
error       = error.err
log         = log.log
queue 4
</pre></div>
</div>
<p>Most of this should look familiar at this point, with the most significant new addition being the final line: <code class="docutils literal notranslate"><span class="pre">queue</span> <span class="pre">4</span></code>. If you create a <code class="docutils literal notranslate"><span class="pre">data.txt</span></code> file in the <code class="docutils literal notranslate"><span class="pre">input</span></code> directory, submit this, and then look at the queue, you will see that HTCondor has indeed scheduled 4 separate jobs. You can see these jobs in the queue individually by running <code class="docutils literal notranslate"><span class="pre">condor_q</span> <span class="pre">-nobatch</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span> ID         OWNER            SUBMITTED     RUN_TIME ST PRI SIZE CMD
2908604.0   djwhite         5/22 12:07   0+00:00:00 I  0    0.0 exec.sh data.txt result.txt
2908604.1   djwhite         5/22 12:07   0+00:00:00 I  0    0.0 exec.sh data.txt result.txt
2908604.2   djwhite         5/22 12:07   0+00:00:00 I  0    0.0 exec.sh data.txt result.txt
2908604.3   djwhite         5/22 12:07   0+00:00:00 I  0    0.0 exec.sh data.txt result.txt

4 jobs; 0 completed, 0 removed, 4 idle, 0 running, 0 held, 0 suspended
</pre></div>
</div>
<p>This shows a bit more information about the jobs than the standard <code class="docutils literal notranslate"><span class="pre">condor_q</span></code>. In particular, note that all of these jobs have the same cluster ID, but each has a different process ID ranging from 0 to 3. In almost all cases, when you submit multiple jobs using a single queue command, they will share the same cluster ID, and have sequential process IDs starting from 0.</p>
<p>There are a couple of issues with the above script. Firstly, we’re running the exact same job (with the exact same input) multiple times, which is rarely what is needed. Secondly, once the jobs have all completed, notice that you only have one <code class="docutils literal notranslate"><span class="pre">output.out</span></code> file - each time one completes, it overwrites any existing output file with its own output because each one has the same name. In order to fix these issues, we need to be able to distinguish each job created by a single submit file. We can do this using the variables <code class="docutils literal notranslate"><span class="pre">$(ClusterId)</span></code> and <code class="docutils literal notranslate"><span class="pre">$(ProcId)</span></code> (or, equivalently, <code class="docutils literal notranslate"><span class="pre">$(Cluster)</span></code> and <code class="docutils literal notranslate"><span class="pre">$(Process)</span></code> respectively). These variables are automatically-defined for each job individually. Using this, you can modify your submit file to read:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>executable  = exec.sh
universe    = vanilla
arguments   = data.txt result_$(ProcID).txt
+JobFlavour = &quot;espresso&quot;

transfer_input_files = my_script.py, input/data.txt
transfer_output_files = result_$(ProcID).txt
should_transfer_files = IF_NEEDED
when_to_transfer_output = ON_EXIT

output      = output/output.$(ClusterId).$(ProcId).out
error       = error/error.$(ClusterId).$(ProcId).err
log         = log/log.$(ProcId).log
queue 4
</pre></div>
</div>
<p>If you first create the folders <code class="docutils literal notranslate"><span class="pre">output</span></code>, <code class="docutils literal notranslate"><span class="pre">error</span></code>, and <code class="docutils literal notranslate"><span class="pre">log</span></code>, and then submit this job, HTCondor will automatically create 4 separate output and error files, and will transfer back 4 separate result files.</p>
<div class="panel panel-challenge docutils container">
<div class="panel-header open docutils container">
<p id="multiple-input-files"><i class="fa fa-square-o"></i> Multiple input files</p>
</div>
<div class="panel-body docutils container">
<p>The result files from the above script all contain the same information, since the same input file is being used and the script is deterministic. How could you modify it to allow for the use of multiple input files?</p>
<div class="panel panel-solution docutils container">
<div class="panel-header docutils container">
<p id="solution"><i class="fa fa-check-square-o"></i> Solution</p>
</div>
<div class="panel-body docutils container">
<p>If you create multiple input files (e.g. <code class="docutils literal notranslate"><span class="pre">input/data_0.txt</span></code>, <code class="docutils literal notranslate"><span class="pre">input/data_1.txt</span></code>, …), you can modify the <code class="docutils literal notranslate"><span class="pre">transfer_input_files</span></code> option to read:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>transfer_input_files = my_script.py, input/data_$(ProcId).txt
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="more-on-variables">
<h2>More on variables<a class="headerlink" href="#more-on-variables" title="Permalink to this headline">¶</a></h2>
<p>As you’ve seen above, the variables that HTCondor automatically defines provide a lot of potential for the automisation of large numbers of jobs. To expand on this, you are also able to define your own variables within your submit file using very similar syntax. Among other things, this is particularly useful for avoiding repetition - in the example above, the input and output file names had to be written in two places. Equivalent functionality can be achieved by using:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>INPUTFN = data.txt
OUTPUTFN = result_$(ProcID).txt
# ...
arguments = $(INPUTFN) $(OUTPUTFN)
# ...
transfer_input_files = my_script.py, input/$(INPUTFN)
transfer_output_files = $(OUTPUTFN)
</pre></div>
</div>
</div>
<div class="section" id="other-ways-to-queue">
<h2>Other ways to queue<a class="headerlink" href="#other-ways-to-queue" title="Permalink to this headline">¶</a></h2>
<p>The above syntax for queuing multiple jobs is very simple and convenient for jobs with sequential enumeration starting from zero, but this isn’t always the case. Fortunately, the queue command is extremely flexible and has many alternative choices of syntax. This part of the lesson showcases some of these options and how to use them. For more information and other examples, you can visit <a class="reference external" href="https://research.cs.wisc.edu/htcondor/manual/v8.5/2_5Submitting_Job.html#SECTION00352000000000000000">the documentation for the queue command</a>.</p>
<ul class="simple">
<li><p><strong>Variable defined from a list</strong>: <code class="docutils literal notranslate"> <span class="pre">queue</span> <span class="pre">[&lt;int</span> <span class="pre">expr&gt;]</span> <span class="pre">[&lt;varname&gt;]</span> <span class="pre">in</span> <span class="pre">[slice]</span> <span class="pre">&lt;list</span> <span class="pre">of</span> <span class="pre">items&gt;</span></code></p></li>
</ul>
<p>This defines a variable name and lets you give it a list of values, and HTCondor will create separate jobs for each value in the list. For example, you could use <code class="docutils literal notranslate"><span class="pre">queue</span> <span class="pre">MagnetPolarity</span> <span class="pre">in</span> <span class="pre">(up,down)</span></code> to automatically create two jobs, each with a variable <code class="docutils literal notranslate"><span class="pre">$(MagnetPolarity)</span></code> defined, which can then be used elsewhere in the submit file to pass either <code class="docutils literal notranslate"><span class="pre">up</span></code> or <code class="docutils literal notranslate"><span class="pre">down</span></code> to other options.</p>
<p>It’s worth noting that the optional parameter <code class="docutils literal notranslate"><span class="pre">&lt;int</span> <span class="pre">expr&gt;</span></code> represents the number of jobs to create per element in the list. By default, its value is 1, meaning that one job is created for each list entry. If you were to instead run <code class="docutils literal notranslate"><span class="pre">queue</span> <span class="pre">4</span> <span class="pre">MagnetPolarity</span> <span class="pre">in</span> <span class="pre">(up,down)</span></code>, a total of 8 jobs would be created, i.e. 4 for <code class="docutils literal notranslate"><span class="pre">up</span></code>, and 4 for <code class="docutils literal notranslate"><span class="pre">down</span></code>, and the variable <code class="docutils literal notranslate"><span class="pre">$(ProcessId)</span></code> would run from 0 to 7. You can use another automatically-defined variable, <code class="docutils literal notranslate"><span class="pre">$(Step)</span></code>, to get the index of the jobs for each list element individually. In this example, <code class="docutils literal notranslate"><span class="pre">$(Step)</span></code> would run from 0 to 3 for jobs with a <code class="docutils literal notranslate"><span class="pre">$(MagnetPolarity)</span></code> value of <code class="docutils literal notranslate"><span class="pre">up</span></code>, and again from 0 to 3 for the <code class="docutils literal notranslate"><span class="pre">down</span></code> value.</p>
<ul class="simple">
<li><p><strong>Multiple variables defined from a list</strong>: <code class="docutils literal notranslate"><span class="pre">queue</span> <span class="pre">[&lt;int</span> <span class="pre">expr&gt;]</span> <span class="pre">[&lt;list</span> <span class="pre">of</span> <span class="pre">varnames&gt;]</span> <span class="pre">from</span> <span class="pre">[slice]</span> <span class="pre">&lt;file</span> <span class="pre">name&gt;</span> <span class="pre">|</span> <span class="pre">&lt;list</span> <span class="pre">of</span> <span class="pre">items&gt;</span></code></p></li>
</ul>
<p>Expanding on the previous option, you can define multiple variables using the <code class="docutils literal notranslate"><span class="pre">from</span></code> syntax. For example, you could use:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>queue MagnetPolarity,NTupleId from (
	up,00083875
	down,00083879
)
</pre></div>
</div>
<p>This would have the effect of creating 2 jobs: one with the values <code class="docutils literal notranslate"><span class="pre">up</span></code> and <code class="docutils literal notranslate"><span class="pre">00083875</span></code>, and one with the values <code class="docutils literal notranslate"><span class="pre">down</span></code> and <code class="docutils literal notranslate"><span class="pre">00083879</span></code>.</p>
<p>You can also put your list into a separate file if you prefer. The above example would be equivalent to using the command <code class="docutils literal notranslate"><span class="pre">queue</span> <span class="pre">MagnetPolarity,NTupleId</span> <span class="pre">from</span> <span class="pre">options.lst</span></code>, where you have a file <code class="docutils literal notranslate"><span class="pre">options.lst</span></code> which looks like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>up,00083875
down,00083879
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Files or directories from a filesystem</strong>: <code class="docutils literal notranslate"><span class="pre">queue</span> <span class="pre">[&lt;int</span> <span class="pre">expr&gt;]</span> <span class="pre">[&lt;varname&gt;]</span> <span class="pre">matching</span> <span class="pre">[files</span> <span class="pre">|</span> <span class="pre">dirs]</span> <span class="pre">[slice]</span> <span class="pre">&lt;list</span> <span class="pre">of</span> <span class="pre">items</span> <span class="pre">with</span> <span class="pre">file</span> <span class="pre">globbing&gt;</span></code></p></li>
</ul>
<p>This method of creating a list of input files is particularly convenient because it doesn’t require you to manually list entries, or to define exactly how many files there are, as the previous methods have. Here, you can use wildcards to get HTCondor to automatically construct the list for you. For example, if you had a set of input <code class="docutils literal notranslate"><span class="pre">.dat</span></code> files and wanted to create a separate job for each one, you could use the command <code class="docutils literal notranslate"><span class="pre">queue</span> <span class="pre">INPUTFN</span> <span class="pre">matching</span> <span class="pre">files</span> <span class="pre">*.dat</span></code>.</p>
</div>
<div class="section" id="mixing-options-and-variables">
<h2>Mixing options and variables<a class="headerlink" href="#mixing-options-and-variables" title="Permalink to this headline">¶</a></h2>
<p>It may have become apparent by now that options and variables behave in a very similar way within a submit file - you provide parameters to an option (e.g. <code class="docutils literal notranslate"><span class="pre">transfer_input_files</span> <span class="pre">=</span> <span class="pre">input.dat</span></code>) using the same syntax as you use to provide a value to a variable (e.g. <code class="docutils literal notranslate"><span class="pre">MyCustomVar</span> <span class="pre">=</span> <span class="pre">25</span></code>). You can think of options as being specific variables that HTCondor looks at to determine how to create and schedule your jobs.</p>
<p>This observation allows for some additional flexibility when using the queue command - when specifying a variable name, you can choose to use the name of an already-defined submit file option for convenience. For example, you could use <code class="docutils literal notranslate"><span class="pre">queue</span> <span class="pre">arguments</span> <span class="pre">in</span> <span class="pre">(-a</span> <span class="pre">200,-a</span> <span class="pre">300,-a</span> <span class="pre">400)</span></code> to automatically create 3 jobs with different arguments.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="local-grid-proxy.html" class="btn btn-neutral float-right" title="Creating a grid proxy without LbScripts" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="htcondor-more-options.html" class="btn btn-neutral float-left" title="More submit file options" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2015-2020, LHCb Starterkit.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>