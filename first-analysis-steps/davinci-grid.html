<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Running DaVinci on the grid &mdash; LHCb Starterkit Lessons  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../_static/panels.css" />
      <link rel="stylesheet" type="text/css" href="../_static/starterkit.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/panels.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Splitting a job into subjobs" href="split-jobs.html" />
    <link rel="prev" title="Analysis Productions" href="analysis-productions.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            LHCb Starterkit Lessons
              <img src="../_static/starterkit.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="README.html">First Analysis Steps</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="prerequisites.html">Pre-workshop checklist</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction-to-course.html">Goals of the course</a></li>
<li class="toctree-l2"><a class="reference internal" href="physics-at-lhcb.html">Physics at LHCb</a><ul>
<li class="toctree-l3"><a class="reference internal" href="physics-at-lhcb.html#the-reconstruction">The reconstruction</a></li>
<li class="toctree-l3"><a class="reference internal" href="physics-at-lhcb.html#building-decay-candidates">Building decay candidates</a></li>
<li class="toctree-l3"><a class="reference internal" href="physics-at-lhcb.html#building-more-complex-decays">Building more complex decays</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="dataflow.html">The LHCb data flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="run-2-data-flow.html">Changes to the data flow in Run 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="analysisflow.html">The analysis flow and analysis preservation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="analysisflow.html#getting-data-files">Getting data files</a></li>
<li class="toctree-l3"><a class="reference internal" href="analysisflow.html#useful-high-energy-physics-analysis-tools">Useful high energy physics analysis tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="analysisflow.html#analysis-preservation">Analysis Preservation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="davinci.html">An introduction to LHCb Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="bookkeeping.html">Finding data in the Bookkeeping</a></li>
<li class="toctree-l2"><a class="reference internal" href="files-from-grid.html">Downloading a file from the grid</a></li>
<li class="toctree-l2"><a class="reference internal" href="interactive-dst.html">Interactively exploring a DST</a></li>
<li class="toctree-l2"><a class="reference internal" href="minimal-dv-job.html">Running a minimal DaVinci job locally</a></li>
<li class="toctree-l2"><a class="reference internal" href="loki-functors.html">Fun with LoKi Functors</a></li>
<li class="toctree-l2"><a class="reference internal" href="add-tupletools.html">TupleTools and branches</a></li>
<li class="toctree-l2"><a class="reference internal" href="decay-tree-fitter.html">How do I use DecayTreeFitter?</a></li>
<li class="toctree-l2"><a class="reference internal" href="analysis-productions.html">Analysis Productions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="analysis-productions.html#monitoring-productions">Monitoring productions</a></li>
<li class="toctree-l3"><a class="reference internal" href="analysis-productions.html#creating-your-own-production">Creating your own production</a><ul>
<li class="toctree-l4"><a class="reference internal" href="analysis-productions.html#testing-your-production-locally">Testing your production locally</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis-productions.html#creating-a-merge-request">Creating a merge request</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis-productions.html#analysis-productions-data">Analysis Productions Data</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Running DaVinci on the grid</a></li>
<li class="toctree-l2"><a class="reference internal" href="split-jobs.html">Splitting a job into subjobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="ganga-data.html">More Ganga</a></li>
<li class="toctree-l2"><a class="reference internal" href="eos-storage.html">Storing large files on EOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="lhcb-dev.html">Developing LHCb Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="dataflow-run3.html">LHCb data flow in Run 3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dataflow-run3.html#lhcb-upgrade">LHCb upgrade</a></li>
<li class="toctree-l3"><a class="reference internal" href="dataflow-run3.html#upgrade-of-the-lhcb-trigger-system">Upgrade of the LHCb trigger system</a><ul>
<li class="toctree-l4"><a class="reference internal" href="dataflow-run3.html#the-hlt-architecture">The HLT architecture</a></li>
<li class="toctree-l4"><a class="reference internal" href="dataflow-run3.html#selective-persistency">Selective persistency</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="dataflow-run3.html#offline-data-processing">Offline data processing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="dataflow-run3.html#changes-to-davinci">Changes to DaVinci</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="asking-questions.html">Asking good questions</a></li>
<li class="toctree-l2"><a class="reference internal" href="ecgd.html">Early career, gender and diversity</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing-lesson.html">Contribute to this lesson</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../second-analysis-steps/README.html">Second Analysis Steps</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/lb-git.html">Using git to develop LHCb software</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/building-decays.html">Building your own decay</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/building-decays-part0.html">The Selection Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/building-decays-part1.html">A Historical Approach</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/building-decays-part2.html">Modern Selection Framework</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/fixing-errors.html">What to do when something fails</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/rerun-stripping.html">Run a different stripping line on simulated data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/switch-mass-hypo.html">Replace a mass hypothesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/filter-in-trees.html">Reuse particles from a decay tree</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/simulation.html">The simulation framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-intro.html">What is Gauss?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-intro.html#choosing-your-gauss-version">Choosing your Gauss Version</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-running-gauss.html">Which option files to use and how to run Gauss</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-running-gauss.html#running-gauss-and-create-a-generator-only-sample">Running Gauss and create a generator-only sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-running-gauss.html#make-an-ntuple">Make an nTuple</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-dkfiles.html">Controlling the decay: DecFiles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-gencuts.html">Modifying the decay</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/simulation-gencuts.html#adding-a-decay-channel">Adding a decay channel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/simulation-gencuts.html#generator-level-cuts">Generator level cuts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/simulation-gencuts.html#removing-the-generator-cuts">Removing the generator cuts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/simulation-gencuts.html#modifying-the-cut-tool">Modifying the cut tool</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-advanced-dkfiles.html">Advanced: Modifying the decay</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-advanced-dkfiles.html#multi-body-decays">3+ multi-body decays</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-advanced-dkfiles.html#cocktail-decays">Cocktail decays</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-advanced-dkfiles.html#final-state-radiation">Final state radiation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-advanced-dkfiles.html#changing-particle-masses-lifetimes-widths">Changing particle masses / lifetimes/ widths</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-advanced-dkfiles.html#finding-constants-used-in-an-existing-mc-sample-masses-lifetimes-etc">Finding Constants Used in an Existing MC Sample (Masses/Lifetimes/etc)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-fastsim.html">Why fast simulation is crucial</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/simulation-fastsim.html#speeding-up-the-detector-simulation">Speeding up the detector simulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/simulation-fastsim.html#speeding-up-the-generation">Speeding up the generation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/hlt-intro.html">HLT intro</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/hlt-intro.html#add-trigger-information-to-your-ntuple">Add trigger information to your ntuple</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/hlt-intro.html#exploring-a-tck-list-of-trigger-lines">Exploring a TCK: List of trigger lines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/hlt-intro.html#add-trigger-information-to-your-ntuple-continued">Add trigger information to your ntuple, continued</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/hlt-intro.html#add-tistos-information-to-your-ntuple">Add TISTOS information to your ntuple</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/hlt-intro.html#exploring-a-tck-properties-of-trigger-lines">Exploring a TCK: Properties of trigger lines</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/tistos-diy.html">TisTos DIY</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/ganga-scripting.html">Scripting Ganga</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/ganga-scripting.html#defining-jobs-with-scripts">Defining jobs with scripts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/ganga-scripting.html#adding-helpers-functions">Adding helpers functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/managing-files-with-ganga.html">Managing files in Ganga</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/advanced-dirac.html">Advanced Dirac</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/advanced-dirac.html#gangatasks">GangaTasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/advanced-dirac.html#alternative-backends-dirac-python-bugged">Alternative Backends - DIRAC (Python bugged)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/advanced-dirac.html#alternative-backends-dirac-davinci">Alternative Backends - DIRAC (DaVinci)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/advanced-dirac.html#alternative-backends-condor">Alternative Backends - Condor</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../self-guided-lessons/README.html">Self guided lessons</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../self-guided-lessons/htcondor.html">Batch submission using HTCondor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/htcondor-first-job.html">Submitting a simple job</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-first-job.html#tracking-your-jobs">Tracking your jobs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/htcondor-more-options.html">More submit file options</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-more-options.html#input-files">Input files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-more-options.html#output-files">Output files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-more-options.html#arguments">Arguments</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-more-options.html#resources-and-requirements">Resources and Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-more-options.html#notifications">Notifications</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/htcondor-queue.html">Using the queue command</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-queue.html#more-on-variables">More on variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-queue.html#other-ways-to-queue">Other ways to queue</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-queue.html#mixing-options-and-variables">Mixing options and variables</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/htcondor.html#system-architecture">System architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/htcondor.html#other-useful-resources">Other useful resources</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html">Creating a grid proxy without LbScripts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#installation">Installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#macos-with-homebrew">macOS with homebrew</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#ubuntu">Ubuntu</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#centos">CentOS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#arch-linux">Arch Linux</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#getting-the-required-files-and-certificates">Getting the required files and certificates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#creating-a-proxy">Creating a proxy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#managing-the-proxy">Managing the proxy</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../CONTRIBUTING.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../CONTRIBUTING.html#dependencies">Dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../CONDUCT.html">Contributor Code of Conduct</a></li>
<li class="toctree-l3"><a class="reference internal" href="../LICENSE.html">Instructional Material</a></li>
<li class="toctree-l3"><a class="reference internal" href="../LICENSE.html#software">Software</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">External links:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://hsf-training.github.io/analysis-essentials/">Analysis essentials</a></li>
<li class="toctree-l1"><a class="reference external" href="https://cern.ch/lhcb-core-doc/">LHCb Core documentation</a></li>
<li class="toctree-l1"><a class="reference external" href="https://lhcb.github.io/glossary/">LHCb glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">LHCb Starterkit Lessons</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="README.html">First Analysis Steps</a></li>
      <li class="breadcrumb-item active">Running DaVinci on the grid</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/lhcb/starterkit-lessons/blob/master/first-analysis-steps/davinci-grid.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="running-davinci-on-the-grid">
<h1>Running DaVinci on the grid<a class="headerlink" href="#running-davinci-on-the-grid" title="Permalink to this heading"></a></h1>
<div class="panel panel-objectives docutils container">
<div class="panel-header open docutils container">
<p id="learning-objectives"><i class="fa fa-line-chart"></i> Learning Objectives</p>
</div>
<div class="panel-body docutils container">
<ul class="simple">
<li><p>Create a ganga job</p></li>
<li><p>Submit a ganga job</p></li>
<li><p>Waiting for ganga</p></li>
<li><p>Find the job output</p></li>
</ul>
</div>
</div>
<p>In certain cases, submitting an <a class="reference internal" href="analysis-productions.html"><span class="doc">Analysis Production</span></a> may not be the best option.
This lesson will teach you how to take our <a class="reference internal" href="minimal-dv-job.html"><span class="doc">minimal DaVinci
job</span></a> and run it on the grid yourself.</p>
<p><code class="docutils literal notranslate"><span class="pre">ganga</span></code> is a program which you can use to interact with your grid
jobs.</p>
<p>Before creating your first <code class="docutils literal notranslate"><span class="pre">ganga</span></code> job, open the script <code class="docutils literal notranslate"><span class="pre">ntuple_options.py</span></code>, obtained in an <a class="reference internal" href="minimal-dv-job.html"><span class="doc">earlier lesson</span></a>, and comment out the lines taking the local input data: we will now use the data stored on grid.</p>
<p>Also, you need to know the path to your data from Bookkeeping.
In our case the path is:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/MC/2016/Beam6500GeV-2016-MagDown-Nu1.6-25ns-Pythia8/Sim09c/Trig0x6138160F/Reco16/Turbo03/Stripping28r1NoPrescalingFlagged/27163002/ALLSTREAMS.DST
</pre></div>
</div>
<p>Note, that here the event type number should be located at the end of the path, which is not the case if you browse the bookkeeping by <code class="docutils literal notranslate"><span class="pre">Event</span> <span class="pre">type</span></code>.</p>
<p>Finally, launch your grid proxy typing <code class="docutils literal notranslate"><span class="pre">lhcb-proxy-init</span></code> and enter your <em>grid certificate</em> password.</p>
<p>Great! Now you are ready to start ganga! Do it with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ganga
</pre></div>
</div>
<p>After <code class="docutils literal notranslate"><span class="pre">ganga</span></code> has started you will be dropped into something that
looks very much like an <code class="docutils literal notranslate"><span class="pre">ipython</span></code> session. <code class="docutils literal notranslate"><span class="pre">ganga</span></code> is built on top of
<code class="docutils literal notranslate"><span class="pre">ipython</span></code> so you can type anything that is legal <code class="docutils literal notranslate"><span class="pre">python</span></code> in addition
to some special commands provided by <code class="docutils literal notranslate"><span class="pre">ganga</span></code>.</p>
<div class="panel panel-callout docutils container">
<div class="panel-header open docutils container">
<p id="help-in-ganga"><i class="fa fa-info-circle"></i> Help in Ganga</p>
</div>
<div class="panel-body docutils container">
<p>As with any python session you can get help on any object or method with <code class="docutils literal notranslate"><span class="pre">help</span></code>. For example <code class="docutils literal notranslate"><span class="pre">help(Job)</span></code> gives you all the information about the Ganga <code class="docutils literal notranslate"><span class="pre">Job</span></code> object.</p>
</div>
</div>
<p>To create your first <code class="docutils literal notranslate"><span class="pre">ganga</span></code> job, type the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">j</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;First ganga job&#39;</span><span class="p">)</span>
<span class="n">myApp</span> <span class="o">=</span> <span class="n">prepareGaudiExec</span><span class="p">(</span><span class="s1">&#39;DaVinci&#39;</span><span class="p">,</span><span class="s1">&#39;v45r8&#39;</span><span class="p">,</span> <span class="n">myPath</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="n">j</span><span class="o">.</span><span class="n">application</span> <span class="o">=</span> <span class="n">myApp</span>
<span class="n">j</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ntuple_options.py&#39;</span><span class="p">]</span>
<span class="n">j</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="s1">&#39;x86_64-centos7-gcc8-opt&#39;</span>
<span class="n">bkPath</span> <span class="o">=</span> <span class="s1">&#39;/MC/2016/Beam6500GeV-2016-MagDown-Nu1.6-25ns-Pythia8/Sim09c/Trig0x6138160F/Reco16/Turbo03/Stripping28r1NoPrescalingFlagged/27163002/ALLSTREAMS.DST&#39;</span>
<span class="n">data</span>  <span class="o">=</span> <span class="n">BKQuery</span><span class="p">(</span><span class="n">bkPath</span><span class="p">,</span> <span class="n">dqflag</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;OK&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">getDataset</span><span class="p">()</span>
<span class="n">j</span><span class="o">.</span><span class="n">inputdata</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>     <span class="c1"># access only the first 2 files of data</span>
<span class="n">j</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">Dirac</span><span class="p">()</span>
<span class="n">j</span><span class="o">.</span><span class="n">splitter</span> <span class="o">=</span> <span class="n">SplitByFiles</span><span class="p">(</span><span class="n">filesPerJob</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">j</span><span class="o">.</span><span class="n">outputfiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">LocalFile</span><span class="p">(</span><span class="s1">&#39;DVntuple.root&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>This will create a <code class="docutils literal notranslate"><span class="pre">Job</span></code> object that will execute <code class="docutils literal notranslate"><span class="pre">DaVinci</span></code> configured
with the option files given in <code class="docutils literal notranslate"><span class="pre">j.application.options</span></code> using a
backend called <code class="docutils literal notranslate"><span class="pre">Dirac</span></code>, which is “the grid”. Instead of specifying the
files to process as part of the options file you have now to tell the
<code class="docutils literal notranslate"><span class="pre">Job</span></code> about it. This allows <code class="docutils literal notranslate"><span class="pre">ganga</span></code> to split your job up by setting <code class="docutils literal notranslate"><span class="pre">j.splitter</span></code>,
processing different files simultaneously. More details about the splitter are given in the <a class="reference internal" href="split-jobs.html"><span class="doc">next lesson</span></a>. Note that data will be accessed using its path in the bookkeeping <code class="docutils literal notranslate"><span class="pre">bkPath</span></code>. In order to speed-up our job, only the first 2 elements (files) of <code class="docutils literal notranslate"><span class="pre">data</span></code> will be accessed; we don’t need to look at much data here.</p>
<div class="panel panel-callout docutils container">
<div class="panel-header open docutils container">
<p id="davincidev-folder"><i class="fa fa-info-circle"></i> DaVinciDev folder</p>
</div>
<div class="panel-body docutils container">
<p>When you create a job using <code class="docutils literal notranslate"><span class="pre">prepareGaudiExec('DaVinci','v45r8',</span> <span class="pre">myPath='.')</span></code>
you get the following message:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>INFO     Set up App Env at: ./DaVinciDev_v45r8
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">ganga</span></code> has created a folder with a local copy of the DaVinci v45r8 release.
The content of it will be sent to the grid to ensure your job runs with
exactly this configuration.
We will use this folder for the following jobs and you will learn more about
this in the <a class="reference internal" href="lhcb-dev.html"><span class="doc">Developing LHCb Software</span></a> lesson.</p>
</div>
</div>
<p>Now you have created your first job, however it has not started
running yet. To submit it type <code class="docutils literal notranslate"><span class="pre">j.submit()</span></code>. Now <code class="docutils literal notranslate"><span class="pre">ganga</span></code> will do the
equivalent of <code class="docutils literal notranslate"><span class="pre">lb-run</span> <span class="pre">DaVinci/v45r8</span></code>, prepare your job and then
ship it off to the grid.</p>
<div class="panel panel-callout docutils container">
<div class="panel-header open docutils container">
<p id="picking-up-a-right-platform"><i class="fa fa-info-circle"></i> Picking up a right platform</p>
</div>
<div class="panel-body docutils container">
<p>The default platform on most lxplus machines is <code class="docutils literal notranslate"><span class="pre">x86_64-centos7-gcc8-opt</span></code> with gcc compiler version 8.
However some older DaVinci version are not compiled for <code class="docutils literal notranslate"><span class="pre">x86_64-centos7-gcc8-opt</span></code>.</p>
<p>The list of platforms available for a certain DaVinci version (let’s try the DaVinci version we are using <code class="docutils literal notranslate"><span class="pre">v45r8</span></code>), can be viewed by</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>lb-run<span class="w"> </span>--list-platforms<span class="w"> </span>DaVinci<span class="w"> </span>v45r8
</pre></div>
</div>
<p>The default compiler platform for GaudiExec applications is <code class="docutils literal notranslate"><span class="pre">x86_64-slc6-gcc62-opt</span></code>.
So for some DaVinci versions, including the latest <code class="docutils literal notranslate"><span class="pre">DaVinci</span> <span class="pre">v45r8</span></code> a few additional actions are needed to set up your ganga job properly.</p>
<p>When setting up your ganga job, add the following line after declaring the <code class="docutils literal notranslate"><span class="pre">j.application</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">j</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="s1">&#39;x86_64-centos7-gcc8-opt&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>While it runs, let’s submit an identical job via slightly different
method. Having to type in the details of each job every time you want
to run it is error prone and tedious. Instead you can place all the
lines that define a job in a file and simply run that.</p>
<p>Place the following in a file called <a class="reference download internal" download="" href="../_downloads/8051061c015862ec27df0e678503ef43/first-job.py"><code class="xref download docutils literal notranslate"><span class="pre">first-job.py</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">j</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;First ganga job&#39;</span><span class="p">)</span>
<span class="n">myApp</span> <span class="o">=</span> <span class="n">GaudiExec</span><span class="p">()</span>
<span class="n">myApp</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="s2">&quot;./DaVinciDev_v45r8&quot;</span>
<span class="n">j</span><span class="o">.</span><span class="n">application</span> <span class="o">=</span> <span class="n">myApp</span>
<span class="n">j</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ntuple_options.py&#39;</span><span class="p">]</span>
<span class="n">j</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="s1">&#39;x86_64-centos7-gcc8-opt&#39;</span>
<span class="n">bkPath</span> <span class="o">=</span> <span class="s1">&#39;/MC/2016/Beam6500GeV-2016-MagDown-Nu1.6-25ns-Pythia8/Sim09c/Trig0x6138160F/Reco16/Turbo03/Stripping28r1NoPrescalingFlagged/27163002/ALLSTREAMS.DST&#39;</span>
<span class="n">data</span>  <span class="o">=</span> <span class="n">BKQuery</span><span class="p">(</span><span class="n">bkPath</span><span class="p">,</span> <span class="n">dqflag</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;OK&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">getDataset</span><span class="p">()</span>
<span class="n">j</span><span class="o">.</span><span class="n">inputdata</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="n">j</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">Dirac</span><span class="p">()</span>
<span class="n">j</span><span class="o">.</span><span class="n">splitter</span> <span class="o">=</span> <span class="n">SplitByFiles</span><span class="p">(</span><span class="n">filesPerJob</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">j</span><span class="o">.</span><span class="n">outputfiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">LocalFile</span><span class="p">(</span><span class="s1">&#39;DVntuple.root&#39;</span><span class="p">)]</span>
<span class="n">j</span><span class="o">.</span><span class="n">submit</span><span class="p">()</span>
</pre></div>
</div>
<p>Which you can execute and submit like so, from within a <code class="docutils literal notranslate"><span class="pre">ganga</span></code>
session:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">ganga</span> <span class="n">first</span><span class="o">-</span><span class="n">job</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>This will print an output similar to the one you saw when submitting the job from within
<code class="docutils literal notranslate"><span class="pre">ganga</span></code>.</p>
<p>You can check on your jobs by typing <code class="docutils literal notranslate"><span class="pre">jobs</span></code> into a <code class="docutils literal notranslate"><span class="pre">ganga</span></code>
console. This will list all of your jobs, their status, what kind of
application they are and more.</p>
<p>You can get more detailed information about your job by typing
<code class="docutils literal notranslate"><span class="pre">jobs($jobid)</span></code>, replacing <code class="docutils literal notranslate"><span class="pre">$jobid</span></code> with the <code class="docutils literal notranslate"><span class="pre">id</span></code> of the job you are
interested in. For concretness we will assume you are interested in
a job with jobid 787 in this example.</p>
<p>Once your job has finished its status will be <code class="docutils literal notranslate"><span class="pre">completed</span></code>. Check this
by typing <code class="docutils literal notranslate"><span class="pre">jobs</span></code> or by printing out the status of one particular job:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Status of my job:&#39;</span><span class="p">,</span> <span class="n">jobs</span><span class="p">(</span><span class="mi">787</span><span class="p">)</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
</pre></div>
</div>
<p>The next thing to do is to find the output of your job. Two things can
happen to files your job creates:</p>
<ul class="simple">
<li><p>They get downloaded by <code class="docutils literal notranslate"><span class="pre">ganga</span></code>, or</p></li>
<li><p>they are stored “on the grid”.</p></li>
</ul>
<p>By default <code class="docutils literal notranslate"><span class="pre">ganga</span></code> will download most files below a size of XX MB. The
rest will remain on the grid. Log files will almost always be downloaded.</p>
<p>To find where the files <code class="docutils literal notranslate"><span class="pre">ganga</span></code> downloaded are you can check the <code class="docutils literal notranslate"><span class="pre">outputdir</span></code>
property of your job.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">output</span> <span class="o">=</span> <span class="n">jobs</span><span class="p">(</span><span class="mi">787</span><span class="p">)</span><span class="o">.</span><span class="n">outputdir</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Job output stored in:&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
<p>Take a look at the contents of this directory.
Tip: this can be done from ganga using command <code class="docutils literal notranslate"><span class="pre">jobs(787).peek()</span></code>.</p>
<div class="panel panel-callout docutils container">
<div class="panel-header open docutils container">
<p id="using-the-shell-from-ipython"><i class="fa fa-info-circle"></i> Using the Shell from IPython</p>
</div>
<div class="panel-body docutils container">
<p>IPython lets you execute shell commands from within the <code class="docutils literal notranslate"><span class="pre">ganga</span></code> session.
This means you can list the contents of a directory without leaving ganga
by typing <code class="docutils literal notranslate"><span class="pre">!ls</span> <span class="pre">/tmp/</span></code>. This will list the contents of the <code class="docutils literal notranslate"><span class="pre">/tmp</span></code> directory.
In our case we can use this to list the contents of the job output directory
with <code class="docutils literal notranslate"><span class="pre">!ls</span> <span class="pre">$output</span></code> as we stored the path in the variable <code class="docutils literal notranslate"><span class="pre">output</span></code>.</p>
</div>
</div>
<p>To look at the <code class="docutils literal notranslate"><span class="pre">root</span></code> file produced by the job start a new terminal, and
type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>lb-run<span class="w"> </span>DaVinci/v45r8<span class="w"> </span><span class="nv">$SHELL</span>
$<span class="w"> </span>root<span class="w"> </span>-l<span class="w"> </span>path/to/the/job/output
</pre></div>
</div>
<p>You need to setup <code class="docutils literal notranslate"><span class="pre">DaVinci</span></code> as we need ROOT version 6 to read the nTuple.</p>
<div class="panel panel-callout docutils container">
<div class="panel-header open docutils container">
<p id="test-your-jobs!"><i class="fa fa-info-circle"></i> Test your jobs!</p>
</div>
<div class="panel-body docutils container">
<p>When submitting large jobs you must test them first! Submitting 1000 subjobs which all fail because of a mistake in your DaVinci options will result in a grumpy email from the grid experts and potentially ending up on low priority lists.</p>
<p>Testing your job is simple - just change the inputdata to only run on one or two files as in this example.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">j</span><span class="o">.</span><span class="n">inputdata</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="panel panel-callout docutils container">
<div class="panel-header open docutils container">
<p id="getting-help-with-ganga"><i class="fa fa-info-circle"></i> Getting help with ganga</p>
</div>
<div class="panel-body docutils container">
<p>To find out more take a look at the <a class="reference external" href="https://twiki.cern.ch/twiki/bin/view/LHCb/FAQ/GangaLHCbFAQ">Ganga
FAQ</a></p>
</div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="analysis-productions.html" class="btn btn-neutral float-left" title="Analysis Productions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="split-jobs.html" class="btn btn-neutral float-right" title="Splitting a job into subjobs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2015-2020, LHCb Starterkit.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>