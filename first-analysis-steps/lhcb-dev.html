<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Developing LHCb Software &mdash; LHCb Starterkit Lessons  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/panels.css" type="text/css" />
      <link rel="stylesheet" href="../_static/starterkit.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/panels.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="LHCb data flow in Run 3" href="dataflow-run3.html" />
    <link rel="prev" title="Storing large files on EOS" href="eos-storage.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> LHCb Starterkit Lessons
            <img src="../_static/starterkit.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="README.html">First Analysis Steps</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="prerequisites.html">Pre-workshop checklist</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction-to-course.html">Goals of the course</a></li>
<li class="toctree-l2"><a class="reference internal" href="physics-at-lhcb.html">Physics at LHCb</a><ul>
<li class="toctree-l3"><a class="reference internal" href="physics-at-lhcb.html#the-reconstruction">The reconstruction</a></li>
<li class="toctree-l3"><a class="reference internal" href="physics-at-lhcb.html#building-decay-candidates">Building decay candidates</a></li>
<li class="toctree-l3"><a class="reference internal" href="physics-at-lhcb.html#building-more-complex-decays">Building more complex decays</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="dataflow.html">The LHCb data flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="run-2-data-flow.html">Changes to the data flow in Run 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="analysisflow.html">The analysis flow and analysis preservation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="analysisflow.html#getting-data-files">Getting data files</a></li>
<li class="toctree-l3"><a class="reference internal" href="analysisflow.html#useful-high-energy-physics-analysis-tools">Useful high energy physics analysis tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="analysisflow.html#analysis-preservation">Analysis Preservation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="davinci.html">An introduction to LHCb Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="bookkeeping.html">Finding data in the Bookkeeping</a></li>
<li class="toctree-l2"><a class="reference internal" href="files-from-grid.html">Downloading a file from the grid</a></li>
<li class="toctree-l2"><a class="reference internal" href="interactive-dst.html">Interactively exploring a DST</a></li>
<li class="toctree-l2"><a class="reference internal" href="minimal-dv-job.html">Running a minimal DaVinci job locally</a></li>
<li class="toctree-l2"><a class="reference internal" href="loki-functors.html">Fun with LoKi Functors</a></li>
<li class="toctree-l2"><a class="reference internal" href="add-tupletools.html">TupleTools and branches</a></li>
<li class="toctree-l2"><a class="reference internal" href="decay-tree-fitter.html">How do I use DecayTreeFitter?</a></li>
<li class="toctree-l2"><a class="reference internal" href="analysis-productions.html">Analysis Productions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="analysis-productions.html#monitoring-productions">Monitoring productions</a></li>
<li class="toctree-l3"><a class="reference internal" href="analysis-productions.html#creating-your-own-production">Creating your own production</a><ul>
<li class="toctree-l4"><a class="reference internal" href="analysis-productions.html#testing-your-production-locally">Testing your production locally</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis-productions.html#creating-a-merge-request">Creating a merge request</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis-productions.html#checks">Checks</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="davinci-grid.html">Running DaVinci on the grid</a></li>
<li class="toctree-l2"><a class="reference internal" href="split-jobs.html">Splitting a job into subjobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="ganga-data.html">More Ganga</a></li>
<li class="toctree-l2"><a class="reference internal" href="eos-storage.html">Storing large files on EOS</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Developing LHCb Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="dataflow-run3.html">LHCb data flow in Run 3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dataflow-run3.html#lhcb-upgrade">LHCb upgrade</a></li>
<li class="toctree-l3"><a class="reference internal" href="dataflow-run3.html#upgrade-of-the-lhcb-trigger-system">Upgrade of the LHCb trigger system</a><ul>
<li class="toctree-l4"><a class="reference internal" href="dataflow-run3.html#the-hlt-architecture">The HLT architecture</a></li>
<li class="toctree-l4"><a class="reference internal" href="dataflow-run3.html#selective-persistency">Selective persistency</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="dataflow-run3.html#offline-data-processing">Offline data processing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="dataflow-run3.html#changes-to-davinci">Changes to DaVinci</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="asking-questions.html">Asking good questions</a></li>
<li class="toctree-l2"><a class="reference internal" href="ecgd.html">Early career, gender and diversity</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing-lesson.html">Contribute to this lesson</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../second-analysis-steps/README.html">Second Analysis Steps</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/lb-git.html">Using git to develop LHCb software</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/building-decays.html">Building your own decay</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/building-decays-part0.html">The Selection Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/building-decays-part1.html">A Historical Approach</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/building-decays-part2.html">Modern Selection Framework</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/fixing-errors.html">What to do when something fails</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/rerun-stripping.html">Run a different stripping line on simulated data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/switch-mass-hypo.html">Replace a mass hypothesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/filter-in-trees.html">Reuse particles from a decay tree</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/simulation.html">The simulation framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-intro.html">What is Gauss?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-intro.html#choosing-your-gauss-version">Choosing your Gauss Version</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-running-gauss.html">Which option files to use and how to run Gauss</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-running-gauss.html#running-gauss-and-create-a-generator-only-sample">Running Gauss and create a generator-only sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-running-gauss.html#make-an-ntuple">Make an nTuple</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-dkfiles.html">Controlling the decay: DecFiles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-gencuts.html">Modifying the decay</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/simulation-gencuts.html#adding-a-decay-channel">Adding a decay channel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/simulation-gencuts.html#generator-level-cuts">Generator level cuts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/simulation-gencuts.html#removing-the-generator-cuts">Removing the generator cuts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/simulation-gencuts.html#modifying-the-cut-tool">Modifying the cut tool</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-advanced-dkfiles.html">Advanced: Modifying the decay</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-advanced-dkfiles.html#multi-body-decays">3+ multi-body decays</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-advanced-dkfiles.html#cocktail-decays">Cocktail decays</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-advanced-dkfiles.html#final-state-radiation">Final state radiation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-advanced-dkfiles.html#changing-particle-masses-lifetimes-widths">Changing particle masses / lifetimes/ widths</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-advanced-dkfiles.html#finding-constants-used-in-an-existing-mc-sample-masses-lifetimes-etc">Finding Constants Used in an Existing MC Sample (Masses/Lifetimes/etc)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-fastsim.html">Why fast simulation is crucial</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/simulation-fastsim.html#speeding-up-the-detector-simulation">Speeding up the detector simulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/simulation-fastsim.html#speeding-up-the-generation">Speeding up the generation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/hlt-intro.html">HLT intro</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/hlt-intro.html#add-trigger-information-to-your-ntuple">Add trigger information to your ntuple</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/hlt-intro.html#exploring-a-tck-list-of-trigger-lines">Exploring a TCK: List of trigger lines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/hlt-intro.html#add-trigger-information-to-your-ntuple-continued">Add trigger information to your ntuple, continued</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/hlt-intro.html#add-tistos-information-to-your-ntuple">Add TISTOS information to your ntuple</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/hlt-intro.html#exploring-a-tck-properties-of-trigger-lines">Exploring a TCK: Properties of trigger lines</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/tistos-diy.html">TisTos DIY</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/ganga-scripting.html">Scripting Ganga</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/ganga-scripting.html#defining-jobs-with-scripts">Defining jobs with scripts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/ganga-scripting.html#adding-helpers-functions">Adding helpers functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/managing-files-with-ganga.html">Managing files in Ganga</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/advanced-dirac.html">Advanced Dirac</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/advanced-dirac.html#gangatasks">GangaTasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/advanced-dirac.html#alternative-backends-dirac-python-bugged">Alternative Backends - DIRAC (Python bugged)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/advanced-dirac.html#alternative-backends-dirac-davinci">Alternative Backends - DIRAC (DaVinci)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/advanced-dirac.html#alternative-backends-condor">Alternative Backends - Condor</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../self-guided-lessons/README.html">Self guided lessons</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../self-guided-lessons/htcondor.html">Batch submission using HTCondor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/htcondor-first-job.html">Submitting a simple job</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-first-job.html#tracking-your-jobs">Tracking your jobs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/htcondor-more-options.html">More submit file options</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-more-options.html#input-files">Input files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-more-options.html#output-files">Output files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-more-options.html#arguments">Arguments</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-more-options.html#resources-and-requirements">Resources and Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-more-options.html#notifications">Notifications</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/htcondor-queue.html">Using the queue command</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-queue.html#more-on-variables">More on variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-queue.html#other-ways-to-queue">Other ways to queue</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-queue.html#mixing-options-and-variables">Mixing options and variables</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/htcondor.html#system-architecture">System architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/htcondor.html#other-useful-resources">Other useful resources</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html">Creating a grid proxy without LbScripts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#installation">Installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#macos-with-homebrew">macOS with homebrew</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#ubuntu">Ubuntu</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#centos">CentOS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#arch-linux">Arch Linux</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#getting-the-required-files-and-certificates">Getting the required files and certificates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#creating-a-proxy">Creating a proxy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#managing-the-proxy">Managing the proxy</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../CONTRIBUTING.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../CONTRIBUTING.html#dependencies">Dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../CONDUCT.html">Contributor Code of Conduct</a></li>
<li class="toctree-l3"><a class="reference internal" href="../LICENSE.html">Instructional Material</a></li>
<li class="toctree-l3"><a class="reference internal" href="../LICENSE.html#software">Software</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">External links:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://hsf-training.github.io/analysis-essentials/">Analysis essentials</a></li>
<li class="toctree-l1"><a class="reference external" href="https://cern.ch/lhcb-core-doc/">LHCb Core documentation</a></li>
<li class="toctree-l1"><a class="reference external" href="https://lhcb.github.io/glossary/">LHCb glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">LHCb Starterkit Lessons</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="README.html">First Analysis Steps</a></li>
      <li class="breadcrumb-item active">Developing LHCb Software</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/lhcb/starterkit-lessons/blob/master/first-analysis-steps/lhcb-dev.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="developing-lhcb-software">
<h1>Developing LHCb Software<a class="headerlink" href="#developing-lhcb-software" title="Permalink to this heading"></a></h1>
<div class="panel panel-objectives docutils container">
<div class="panel-header open docutils container">
<p id="learning-objectives"><i class="fa fa-line-chart"></i> Learning Objectives</p>
</div>
<div class="panel-body docutils container">
<ul class="simple">
<li><p>Learn how to work with and modify LHCb software projects and packages</p></li>
<li><p>Learn how to find and search the source code and its documentation</p></li>
</ul>
</div>
</div>
<div class="panel panel-prereq docutils container">
<div class="panel-header open docutils container">
<p id="prerequisites"><i class="fa fa-rocket"></i> Prerequisites</p>
</div>
<div class="panel-body docutils container">
<p>Before starting, you should have a basic understanding of how to use <code class="docutils literal notranslate"><span class="pre">git</span></code>,
similar to what has been
<a class="reference external" href="https://hsf-training.github.io/analysis-essentials/git">taught</a> during the
Starterkit.</p>
</div>
</div>
<p>In this lesson, we’ll show you a complete workflow for developing the LHCb
software using the Git version control system.  At LHCb, we use GitLab to
manage our Git repositories.  Among other features, GitLab allows you to browse
the source code for each project, and to review proposed changes (called <em>merge
requests</em>) in a convenient web interface.  You can find the CERN GitLab
instance at <a class="reference external" href="https://gitlab.cern.ch">https://gitlab.cern.ch</a>.</p>
<p>In principle, there are multiple ways of interacting with the LHCb software
repositories:</p>
<ol class="simple">
<li><p>A vanilla Git workflow using only the standard Git commands.  This requires
you to <code class="docutils literal notranslate"><span class="pre">clone</span></code> and compile an entire LHCb project at a time.</p></li>
<li><p>An LHCb-specific workflow using a set of <code class="docutils literal notranslate"><span class="pre">lb-*</span></code> Git subcommands.  This allows
you to check out individual packages inside a project, and streamlines the
modification of a few packages at a time.</p></li>
</ol>
<p>Here, we want to focus on the second workflow. The first workflow will be
discussed briefly at the <a class="reference external" href="#working-with-a-full-project-checkout">bottom</a> of
this page. Note that, although the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">lb-*</span></code> commands are much easier for small
changes to existing packages where recompiling an entire project would be
cumbersome, for any serious development the usage of vanilla Git is much more
stable. Please consider using it if you can spare the compilation time.</p>
<div class="panel panel-callout docutils container">
<div class="panel-header open docutils container">
<p id="initial-setup"><i class="fa fa-info-circle"></i> Initial setup</p>
</div>
<div class="panel-body docutils container">
<p>Before jumping in by creating a project in GitLab, you should make sure that
your local Git configuration and your settings on GitLab are sufficiently set
up.</p>
<ul>
<li><p>Your name and email address should be set up in your local Git
configuration.  To ensure that this is the case, run</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>git config --global user.name &quot;Your Name&quot;
git config --global user.email &quot;your.name@cern.ch&quot;
</pre></div>
</div>
<p>and put in your information.</p>
</li>
<li><p>Next, visit <a class="reference external" href="https://gitlab.cern.ch/profile/keys">https://gitlab.cern.ch/profile/keys</a>
(logging in with your CERN credentials) and add an SSH key.</p></li>
<li><p>Finally, run this LHCb-specific configuration command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>git config --global lb-use.protocol ssh
</pre></div>
</div>
<p>This makes sure the LHCb commands use the ssh protocol instead of https.</p>
</li>
</ul>
</div>
</div>
<p>This lesson introduces the commands:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">lb-dev</span></code> for setting up a new development environment</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">lb-use</span></code> and <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">lb-checkout</span></code> for downloading LHCb software packages</p></li>
</ul>
<p>If you want to make changes to a software package, you will need to set up a
development environment. <code class="docutils literal notranslate"><span class="pre">lb-dev</span></code> is your friend here:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>lb-dev --name DaVinciDev DaVinci/v45r8
</pre></div>
</div>
<p>The output should look similar to this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Successfully created the local project DaVinciDev for x86_64-centos7-gcc9-opt in .

To start working:

  &gt; cd ./DaVinciDev
  &gt; git lb-use DaVinci
  &gt; git lb-checkout DaVinci/vXrY MyPackage

then

  &gt; make
  &gt; make test

and optionally (CMake only)

  &gt; make install

To build for another platform call

  &gt; make platform=&lt;platform id&gt;

You can customize the configuration by editing the files &#39;build.conf&#39; and &#39;CMakeLists.txt&#39;
(see https://twiki.cern.ch/twiki/bin/view/LHCb/GaudiCMakeConfiguration for details).
</pre></div>
</div>
<div class="panel panel-callout docutils container">
<div class="panel-header open docutils container">
<p id="lb-dev-created-local-projects-are-git-repositories"><i class="fa fa-info-circle"></i> lb-dev created local projects are Git repositories</p>
</div>
<div class="panel-body docutils container">
<p>When <code class="docutils literal notranslate"><span class="pre">lb-dev</span></code> creates the local project directory and creates the initial
files there, it also calls <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">init</span></code> and commits the first version of
the files to the local Git repository (try running <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">log</span></code> in there).</p>
<p>You can then use Git to keep track of your development, and share your code
with others (for example with a <a class="reference external" href="https://gitlab.cern.ch/projects/new">new project in
gitlab.cern.ch</a>).</p>
<p>You can even create a new project in GitLab without leaving the terminal!
Just define the git remote and a new project will be created as soon as you push.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>git remote add ssh://git@gitlab.cern.ch:7999/&lt;username&gt;/&lt;project-name&gt;.git
git push -u origin master
</pre></div>
</div>
</div>
</div>
<p>Follow those instructions to compile the software:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> DaVinciDev
make
</pre></div>
</div>
<p>Once that’s done, let’s try it out:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./run gaudirun.py
</pre></div>
</div>
<p>We just successfully ran the simplest possible Gaudi job with <code class="docutils literal notranslate"><span class="pre">gaudirun.py</span></code>!
The <code class="docutils literal notranslate"><span class="pre">./run</span></code> script runs the command that follows in the project “runtime”
environment where the right varialbes are set.
It works similar to <code class="docutils literal notranslate"><span class="pre">lb-run</span></code>, without the need to specify a package and version.</p>
<div class="panel panel-discussion docutils container">
<div class="panel-header docutils container">
<p id="obtain-a-shell-with-the-runtime-environment"><i class="fa fa-bell"></i> Obtain a shell with the runtime environment</p>
</div>
<div class="panel-body docutils container">
<p>Sometimes it is convenient to get a shell with the runtime environment
so that you don’t need to prefix commands with <code class="docutils literal notranslate"><span class="pre">./run</span></code> all the time.
To do this, simply run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./run bash -l
</pre></div>
</div>
<p>While useful, it is generally advised to stick to prefixing commands with
<code class="docutils literal notranslate"><span class="pre">./run</span></code> (or <code class="docutils literal notranslate"><span class="pre">lb-run</span></code>). This way the command starts in the same reproducible
environment every time and there’s less risk of getting to an inconsistent
state.</p>
</div>
</div>
<p>Your new development environment won’t be very useful without any software to
modify and build.  So let’s check out one of the existing LHCb packages! These
are stored in the <a class="reference external" href="https://gitlab.cern.ch/lhcb">LHCb Git repositories</a>.</p>
<p>In order to obtain the source code of the package you want to work on, we’ll
use the method described at the <a class="reference external" href="http://lhcb-core-doc.web.cern.ch/lhcb-core-doc/GitForLHCbUsers.html">Git4LHCb</a> page.
These are a set of subcommands, starting with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">lb-</span></code>, that are designed to make
developing LHCb software easier.
For example, if you want to modify a <code class="docutils literal notranslate"><span class="pre">TupleTool</span></code>
(which you discovered in the <a class="reference internal" href="add-tupletools.html"><span class="doc">TupleTools and branches</span></a> lesson),
start by executing the following in the <code class="docutils literal notranslate"><span class="pre">DaVinciDev</span></code> directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git lb-use Analysis
git lb-checkout Analysis/run2-patches Phys/DecayTreeTuple
</pre></div>
</div>
<div class="panel panel-discussion docutils container">
<div class="panel-header docutils container">
<p id="what-if-git-asks-for-my-password?"><i class="fa fa-bell"></i> What if git asks for my password?</p>
</div>
<div class="panel-body docutils container">
<p>Make sure you succesfully completed the instructions under <a class="reference external" href="#initial-setup">initial
setup</a>.</p>
</div>
</div>
<p>Under the hood, <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">lb-use</span></code> will add and fetch the
<a class="reference external" href="https://gitlab.cern.ch/lhcb/Analysis"><code class="docutils literal notranslate"><span class="pre">Analysis</span></code></a> repository as a remote in
Git – check this with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">remote</span> <span class="pre">-v</span></code>!  <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">lb-checkout</span></code> will then perform a
<em>partial</em> checkout of the <code class="docutils literal notranslate"><span class="pre">run2-patches</span></code> branch of the Analysis repository, only
adding the files under the
<a class="reference external" href="https://gitlab.cern.ch/lhcb/Analysis/tree/run2-patches/Phys/DecayTreeTuple"><code class="docutils literal notranslate"><span class="pre">Phys/DecayTreeTuple</span></code></a>.
directory.</p>
<div class="panel panel-callout docutils container">
<div class="panel-header open docutils container">
<p id="which-project-to-use-in-git-lb-use?"><i class="fa fa-info-circle"></i> Which project to use in git lb-use?</p>
</div>
<div class="panel-body docutils container">
<p>The project name to pass to <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">lb-use</span></code> depends on the directories you want
to check out and work on, and not on the project name you passed to <code class="docutils literal notranslate"><span class="pre">lb-dev</span></code>.
Moreover you can call <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">lb-use</span></code> several times for different remote
projects in the same local project:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>lb-dev --name DaVinciDev DaVinci/v45r8
<span class="nb">cd</span> DaVinciDev
git lb-use Analysis
git lb-use Stripping
git lb-use DaVinci
</pre></div>
</div>
<p>Note that in order for this to work, projects you specify in <code class="docutils literal notranslate"><span class="pre">lb-use</span></code> must
be dependencies of the project you specify in <code class="docutils literal notranslate"><span class="pre">lb-dev</span></code>. In other words, the top-level
project should be at the top of the <a class="reference external" href="http://lhcb.web.cern.ch/computing/">dependency
chain</a>.</p>
</div>
</div>
<p>After checking out new packages, always remember to make them known to your
local project with <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">configure</span></code> (sometimes it might be necessary to fully
clean up the build with <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">purge</span></code>):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make configure
</pre></div>
</div>
<p>You can now modify the <code class="docutils literal notranslate"><span class="pre">Phys/DecayTreeTuple</span></code> package and run <code class="docutils literal notranslate"><span class="pre">make</span></code> to build
it with your changes. You can test your changes with the <code class="docutils literal notranslate"><span class="pre">./run</span></code> script.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./run gaudirun.py ntuple_options.py
</pre></div>
</div>
<p>If you have made changes that you’d like to be integrated into the official
LHCb repositories, you can use <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">lb-push</span></code> to push it to a new branch in the
central Git repository. But please read the <a class="reference external" href="http://lhcb-core-doc.web.cern.ch/lhcb-core-doc/GitForLHCbUsers.html#using-git-for-lhcb-development">instructions
page</a>
first.</p>
<p>Note that no one has permission to push directly to the official protected branches (e.g. <code class="docutils literal notranslate"><span class="pre">master</span></code> or <code class="docutils literal notranslate"><span class="pre">run2-patches</span></code>) of LHCb projects.
To get your changes merged there from the branch to which you <code class="docutils literal notranslate"><span class="pre">lb-push</span></code>-ed, you need to create a merge request (MR), so the project maintainer can check your code.
This can be done on the <a class="reference external" href="https://gitlab.cern.ch/lhcb/Analysis/-/merge_requests/new">project repository web page</a>, for example.</p>
<div class="panel panel-callout docutils container">
<div class="panel-header open docutils container">
<p id="quick-link-to-create-a-merge-request"><i class="fa fa-info-circle"></i> Quick link to create a merge request</p>
</div>
<div class="panel-body docutils container">
<p>When pushing to a branch in a project in GitLab you will see a message like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>remote:
remote: Create merge request for my-branch:
remote:   https://gitlab.cern.ch/lhcb/Analysis/merge_requests/new?merge_request%5Bsource_branch%5D=my-branch
remote:
</pre></div>
</div>
<p>You can use the URL in the message to quickly create a merge request for the
changes you just pushed.</p>
</div>
</div>
<p>When your merge request is approved and merged (which can be after some additional commits on your part), your changes are part of an official branch of the respective project, and your contributions are part of the LHCb software stack.
Congratulations!</p>
<div class="panel panel-callout docutils container">
<div class="panel-header open docutils container">
<p id="nightlies"><i class="fa fa-info-circle"></i> Nightlies</p>
</div>
<div class="panel-body docutils container">
<p>Typically before being approved every merge request will be tested in the so-called <a class="reference external" href="https://lhcb-nightlies.web.cern.ch">nightly builds</a>.
The nightly build infrastructure allows for building and testing the entire stack of LHCb physics projects, either overnight (in standard slots such as <code class="docutils literal notranslate"><span class="pre">lhcb-run2-patches</span></code>) or on demand (using <code class="docutils literal notranslate"><span class="pre">/ci-test</span></code> in GitLab discussions).
The relevant maintainers will help with the exact workflow (e.g. who schedules the testing), which varies a bit depending on the project.</p>
<p>The automatic builds and tests can show compilation problems (e.g. new warnings) and unintended consequences of the proposed changes.
To achieve the latter, they run some reference jobs and compare the output of the new build with a reference file.</p>
<p>If the aim of the commit was to change the ouput, e.g. because you increased
the track reconstruction efficiency by a factor of two, mention it in the
merge request description, such that the maintainers of the affected project can
update the reference file.</p>
<p>Often it is useful to work directly from nightly builds (e.g. to debug an issue on another platform).
You can use a nightly build version of a project with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>lb-dev -c x86_64-centos7-gcc9-opt --nightly lhcb-run2-patches DaVinci/run2-patches
</pre></div>
</div>
<p>A more detailed description of the command is found at <a class="reference external" href="https://twiki.cern.ch/twiki/bin/view/LHCb/SoftwareEnvTools">SoftwareEnvTools</a>.</p>
</div>
</div>
<p>If you want to take a look the source code, without checking it out, you can
easily access the repository through the <a class="reference external" href="https://gitlab.cern.ch/lhcb">GitLab web
interface</a>. This website also provides search
functionality, but the output is not always easy to read, especially if it
returns many hits. To search a project much quicker, you can use <code class="docutils literal notranslate"><span class="pre">lb-glimpse</span></code>.
It allows you to search for a given string in the source code of a particular
LHCb project (and all its dependencies).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>lb-glimpse <span class="s2">&quot;PVRefitter&quot;</span> DaVinci/v45r8
</pre></div>
</div>
<p>This works with every LHCb project and released version. Since it’s a shell
command, you can easily process the output using <code class="docutils literal notranslate"><span class="pre">less</span></code>, <code class="docutils literal notranslate"><span class="pre">grep</span></code>, and other
tools.</p>
<p>To get an idea of how a certain component of the LHCb software works, you can
also access the doxygen documentation. One set of doxygen web pages is
generated for several related projects, and is linked from the projects web
sites, like <a class="reference external" href="http://lhcbdoc.web.cern.ch/lhcbdoc/davinci/">for DaVinci</a>.
For example, the doxygen documentation for DaVinci v45r8 is
<a class="reference external" href="https://lhcb-doxygen.web.cern.ch/lhcb-doxygen/davinci/v45r8/index.html">here</a>.
See also the <a class="reference external" href="https://lhcb.web.cern.ch/computing/">LHCb Computing web page</a> for a
list of projects.</p>
<div class="panel panel-callout docutils container">
<div class="panel-header open docutils container">
<p id="working-with-a-full-project-checkout"><i class="fa fa-info-circle"></i> Working with a full project checkout</p>
</div>
<div class="panel-body docutils container">
<p>The <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">lb-*</span></code> commands are not strictly necessary, but they’re very convenient
if you just want to quickly edit one package. Otherwise you’d have to build
the entire project in which the package is residing, instead of using the
precompiled version. However, if you develop across multiple packages, or
want to use more sophisticated <code class="docutils literal notranslate"><span class="pre">git</span></code> commands, nothing prevents you from
checking out an entire project – just don’t be surprised if it takes hours
to compile on lxplus! Note that repeated compilation will be much faster
and using a dedicated multi-core machine can speed things up a lot.</p>
<p>To check out a project, run the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone https://:@gitlab.cern.ch:8443/lhcb/DaVinci.git
</pre></div>
</div>
<p>replacing <code class="docutils literal notranslate"><span class="pre">DaVinci</span></code> with the project name of your choice. Next, initialise
and compile it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>lb-project-init
make
</pre></div>
</div>
<p>optionally followed by <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test</span></code> to run the tests and/or <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">install</span></code> to
install it to the <code class="docutils literal notranslate"><span class="pre">InstallArea</span></code> directory. That’s all! You now have a vanilla
Git repository containing all the source files of the project.
You can find out more about working with full projects at the
<a class="reference external" href="http://lhcb-core-doc.web.cern.ch/lhcb-core-doc/GitForLHCbUsers.html">Git4LHCb</a>
page.</p>
</div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="eos-storage.html" class="btn btn-neutral float-left" title="Storing large files on EOS" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="dataflow-run3.html" class="btn btn-neutral float-right" title="LHCb data flow in Run 3" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2015-2020, LHCb Starterkit.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>