

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The analysis flow and analysis preservation &mdash; LHCb Starterkit Lessons  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/panels.css?v=69fd799d" />
      <link rel="stylesheet" type="text/css" href="../_static/starterkit.css?v=be2937d8" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/panels.js?v=0f4bdeea"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="An introduction to LHCb Software" href="davinci.html" />
    <link rel="prev" title="Changes to the data flow in Run 2" href="run-2-data-flow.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            LHCb Starterkit Lessons
              <img src="../_static/starterkit.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="README.html">First Analysis Steps</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="prerequisites.html">Pre-workshop checklist</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction-to-course.html">Goals of the course</a></li>
<li class="toctree-l2"><a class="reference internal" href="physics-at-lhcb.html">Physics at LHCb</a><ul>
<li class="toctree-l3"><a class="reference internal" href="physics-at-lhcb.html#the-reconstruction">The reconstruction</a></li>
<li class="toctree-l3"><a class="reference internal" href="physics-at-lhcb.html#building-decay-candidates">Building decay candidates</a></li>
<li class="toctree-l3"><a class="reference internal" href="physics-at-lhcb.html#building-more-complex-decays">Building more complex decays</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="dataflow.html">The LHCb data flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="run-2-data-flow.html">Changes to the data flow in Run 2</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">The analysis flow and analysis preservation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#getting-data-files">Getting data files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#useful-high-energy-physics-analysis-tools">Useful high energy physics analysis tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="#analysis-preservation">Analysis Preservation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="davinci.html">An introduction to LHCb Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="bookkeeping.html">Finding data in the Bookkeeping</a></li>
<li class="toctree-l2"><a class="reference internal" href="files-from-grid.html">Downloading a file from the grid</a></li>
<li class="toctree-l2"><a class="reference internal" href="interactive-dst.html">Interactively exploring a DST</a></li>
<li class="toctree-l2"><a class="reference internal" href="minimal-dv-job.html">Running a minimal DaVinci job locally</a></li>
<li class="toctree-l2"><a class="reference internal" href="loki-functors.html">Fun with LoKi Functors</a></li>
<li class="toctree-l2"><a class="reference internal" href="add-tupletools.html">TupleTools and branches</a></li>
<li class="toctree-l2"><a class="reference internal" href="decay-tree-fitter.html">How do I use DecayTreeFitter?</a></li>
<li class="toctree-l2"><a class="reference internal" href="analysis-productions.html">Analysis Productions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="analysis-productions.html#monitoring-productions">Monitoring productions</a></li>
<li class="toctree-l3"><a class="reference internal" href="analysis-productions.html#creating-your-own-production">Creating your own production</a><ul>
<li class="toctree-l4"><a class="reference internal" href="analysis-productions.html#testing-your-production-locally">Testing your production locally</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis-productions.html#creating-a-merge-request">Creating a merge request</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis-productions.html#analysis-productions-data">Analysis Productions Data</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="davinci-grid.html">Running DaVinci on the grid</a></li>
<li class="toctree-l2"><a class="reference internal" href="split-jobs.html">Splitting a job into subjobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="ganga-data.html">More Ganga</a></li>
<li class="toctree-l2"><a class="reference internal" href="eos-storage.html">Storing large files on EOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="lhcb-dev.html">Developing LHCb Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="dataflow-run3.html">LHCb data flow in Run 3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dataflow-run3.html#lhcb-upgrade">LHCb upgrade</a></li>
<li class="toctree-l3"><a class="reference internal" href="dataflow-run3.html#upgrade-of-the-lhcb-trigger-system">Upgrade of the LHCb trigger system</a><ul>
<li class="toctree-l4"><a class="reference internal" href="dataflow-run3.html#the-hlt-architecture">The HLT architecture</a></li>
<li class="toctree-l4"><a class="reference internal" href="dataflow-run3.html#selective-persistency">Selective persistency</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="dataflow-run3.html#offline-data-processing">Offline data processing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="dataflow-run3.html#changes-to-davinci">Changes to DaVinci</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="asking-questions.html">Asking good questions</a></li>
<li class="toctree-l2"><a class="reference internal" href="ecgd.html">Early career, gender and diversity</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing-lesson.html">Contribute to this lesson</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../second-analysis-steps/README.html">Second Analysis Steps</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/lb-git.html">Using git to develop LHCb software</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/building-decays.html">Building your own decay</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/building-decays-part0.html">The Selection Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/building-decays-part1.html">A Historical Approach</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/building-decays-part2.html">Modern Selection Framework</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/fixing-errors.html">What to do when something fails</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/rerun-stripping.html">Run a different stripping line on simulated data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/switch-mass-hypo.html">Replace a mass hypothesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/filter-in-trees.html">Reuse particles from a decay tree</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/simulation.html">The simulation framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-intro.html">What is Gauss?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-intro.html#choosing-your-gauss-version">Choosing your Gauss Version</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-running-gauss.html">Which option files to use and how to run Gauss</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-running-gauss.html#running-gauss-and-create-a-generator-only-sample">Running Gauss and create a generator-only sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-running-gauss.html#make-an-ntuple">Make an nTuple</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-dkfiles.html">Controlling the decay: DecFiles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-gencuts.html">Modifying the decay</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/simulation-gencuts.html#adding-a-decay-channel">Adding a decay channel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/simulation-gencuts.html#generator-level-cuts">Generator level cuts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/simulation-gencuts.html#removing-the-generator-cuts">Removing the generator cuts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/simulation-gencuts.html#modifying-the-cut-tool">Modifying the cut tool</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-advanced-dkfiles.html">Advanced: Modifying the decay</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-advanced-dkfiles.html#multi-body-decays">3+ multi-body decays</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-advanced-dkfiles.html#cocktail-decays">Cocktail decays</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-advanced-dkfiles.html#final-state-radiation">Final state radiation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-advanced-dkfiles.html#changing-particle-masses-lifetimes-widths">Changing particle masses / lifetimes/ widths</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-advanced-dkfiles.html#finding-constants-used-in-an-existing-mc-sample-masses-lifetimes-etc">Finding Constants Used in an Existing MC Sample (Masses/Lifetimes/etc)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-fastsim.html">Why fast simulation is crucial</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/simulation-fastsim.html#speeding-up-the-detector-simulation">Speeding up the detector simulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/simulation-fastsim.html#speeding-up-the-generation">Speeding up the generation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/hlt-intro.html">HLT intro</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/hlt-intro.html#add-trigger-information-to-your-ntuple">Add trigger information to your ntuple</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/hlt-intro.html#exploring-a-tck-list-of-trigger-lines">Exploring a TCK: List of trigger lines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/hlt-intro.html#add-trigger-information-to-your-ntuple-continued">Add trigger information to your ntuple, continued</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/hlt-intro.html#add-tistos-information-to-your-ntuple">Add TISTOS information to your ntuple</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/hlt-intro.html#exploring-a-tck-properties-of-trigger-lines">Exploring a TCK: Properties of trigger lines</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/tistos-diy.html">TisTos DIY</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/ganga-scripting.html">Scripting Ganga</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/ganga-scripting.html#defining-jobs-with-scripts">Defining jobs with scripts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/ganga-scripting.html#adding-helpers-functions">Adding helpers functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/managing-files-with-ganga.html">Managing files in Ganga</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/advanced-dirac.html">Advanced Dirac</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/advanced-dirac.html#gangatasks">GangaTasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/advanced-dirac.html#alternative-backends-dirac-python-bugged">Alternative Backends - DIRAC (Python bugged)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/advanced-dirac.html#alternative-backends-dirac-davinci">Alternative Backends - DIRAC (DaVinci)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/advanced-dirac.html#alternative-backends-condor">Alternative Backends - Condor</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/containers.html">Containers and running legacy code</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../self-guided-lessons/README.html">Self guided lessons</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../self-guided-lessons/htcondor.html">Batch submission using HTCondor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/htcondor-first-job.html">Submitting a simple job</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-first-job.html#tracking-your-jobs">Tracking your jobs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/htcondor-more-options.html">More submit file options</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-more-options.html#input-files">Input files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-more-options.html#output-files">Output files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-more-options.html#arguments">Arguments</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-more-options.html#resources-and-requirements">Resources and Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-more-options.html#notifications">Notifications</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/htcondor-queue.html">Using the queue command</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-queue.html#more-on-variables">More on variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-queue.html#other-ways-to-queue">Other ways to queue</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-queue.html#mixing-options-and-variables">Mixing options and variables</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/htcondor.html#system-architecture">System architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/htcondor.html#other-useful-resources">Other useful resources</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html">Creating a grid proxy without LbScripts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#installation">Installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#macos-with-homebrew">macOS with homebrew</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#ubuntu">Ubuntu</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#centos">CentOS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#arch-linux">Arch Linux</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#getting-the-required-files-and-certificates">Getting the required files and certificates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#creating-a-proxy">Creating a proxy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#managing-the-proxy">Managing the proxy</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../CONTRIBUTING.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../CONTRIBUTING.html#dependencies">Dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../CONDUCT.html">Contributor Code of Conduct</a></li>
<li class="toctree-l3"><a class="reference internal" href="../LICENSE.html">Instructional Material</a></li>
<li class="toctree-l3"><a class="reference internal" href="../LICENSE.html#software">Software</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">External links:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../interesting-links/analysis-essentials.html">HSF analysis essentials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../interesting-links/analysis-essentials.html#an-introduction-to-python">An introduction to Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interesting-links/analysis-essentials.html#advanced-python-tutorial">Advanced Python tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interesting-links/analysis-essentials.html#introducing-the-shell">Introducing the shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interesting-links/analysis-essentials.html#unix-shell">UNIX shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interesting-links/analysis-essentials.html#analysis-automation-with-snakemake">Analysis automation with Snakemake</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interesting-links/analysis-essentials.html#version-control-with-git">Version control with Git</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://cern.ch/lhcb-core-doc/">LHCb Core documentation</a></li>
<li class="toctree-l1"><a class="reference external" href="https://lhcb.github.io/glossary/">LHCb glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">LHCb Starterkit Lessons</a>
      </nav>

      <div class="wy-nav-content">
  
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="README.html">First Analysis Steps</a></li>
      <li class="breadcrumb-item active">The analysis flow and analysis preservation</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/lhcb/starterkit-lessons/blob/master/first-analysis-steps/analysisflow.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="the-analysis-flow-and-analysis-preservation">
<h1>The analysis flow and analysis preservation<a class="headerlink" href="#the-analysis-flow-and-analysis-preservation" title="Link to this heading"></a></h1>
<div class="panel panel-objectives docutils container">
<div class="panel-header open docutils container">
<p id="learning-objectives"><i class="fa fa-line-chart"></i> Learning Objectives</p>
</div>
<div class="panel-body docutils container">
<ul class="simple">
<li><p>Learn about analysis tools</p></li>
<li><p>Learn about analysis preservation</p></li>
</ul>
</div>
</div>
<p>Most LHCb analyses share a similar structure and follow a similar procedure pipeline.
As a user you often start developing your analysis by retrieving the data and simulation samples that you need.<br />Giving you tools to get those samples is the main goal of the first analysis steps lessons.</p>
<div class="panel panel-callout docutils container">
<div class="panel-header open docutils container">
<p id="reminder-from-the-data-flow-lesson"><i class="fa fa-info-circle"></i> Reminder from the data flow lesson</p>
</div>
<div class="panel-body docutils container">
<p>The output of the last stages of the <a class="reference internal" href="dataflow.html"><span class="doc">LHCb data flow</span></a> - Stripping (Runs 1 and 2), Turbo stream (Run 2), Sprucing (Run 3) or Run 3 HLT2 lines - can be accessed by the user.
Selections made at these last stages are also defined by users.
Their outputs are saved to disk and later used to produce data files that will contain only the information that interests users.
This is done using the software package called DaVinci.</p>
</div>
</div>
<section id="getting-data-files">
<h2>Getting data files<a class="headerlink" href="#getting-data-files" title="Link to this heading"></a></h2>
<p>After preselecting data either in the Stripping, Sprucing or triggering step, users can produce ROOT files containing <em>ntuples</em>, running the DaVinci application.
An ntuple is a (often complex) data structure typically stored within a (ROOT) file, which contains information about events or candidates in the data sample, such as the candidate mass or trigger decision flags.
For data samples the available information is solely that coming from the reconstruction, but for simulation samples you can request both the reconstructed values of observables/variables and the generator-level (truth) values.</p>
<p>The reconstructed values are the ones that passed the entire reconstruction pipeline with detector effects included and generator-level values are the original values that the event generator has produced.
Certain variables, for example, vertex quality or trigger decisions, can only be accessed on the reconstruction level.
This allows to study different reconstruction and detector effects for your analysis.</p>
<p>DaVinci can be run locally on <code class="docutils literal notranslate"><span class="pre">lxplus</span></code> (for small tasks) or on the Grid computing system via <a class="reference internal" href="davinci-grid.html"><span class="doc">Ganga</span></a> or via <a class="reference internal" href="analysis-productions.html"><span class="doc">Analysis Productions</span></a>.
Using Ganga will give you more control over the jobs (short scripts and macros you run on the remote machines) and also will allow you to do way more than just running DaVinci.
Analysis Productions, however, are more user-friendly and provide a set of tests that ensure your jobs will be run as expected with minimal errors.
Analysis Productions can be very useful for the preservation of your analysis.
We will discuss the concept of analysis preservation a bit later in this lesson.</p>
<p>In first analysis steps we cover both running DaVinci on <a class="reference external" href="https://lhcb.github.io/starterkit-lessons/first-analysis-steps/davinci-grid.html">Ganga</a> and via <a class="reference external" href="https://lhcb.github.io/starterkit-lessons/first-analysis-steps/analysis-productions.html">Analysis Productions</a>.</p>
</section>
<section id="useful-high-energy-physics-analysis-tools">
<h2>Useful high energy physics analysis tools<a class="headerlink" href="#useful-high-energy-physics-analysis-tools" title="Link to this heading"></a></h2>
<p>After getting the ntuples a user usually develops new analysis code or expands an existing code, that their collaborators use.
Analysis code is usually based on the popular high-energy physics software tools or on the more general data analysis tools, like <a class="reference external" href="https://numpy.org/">numpy</a> or <a class="reference external" href="https://pandas.pydata.org/">pandas</a>.</p>
<div class="panel panel-callout docutils container">
<div class="panel-header open docutils container">
<p id="popular-data-analysis-tools-in-hep"><i class="fa fa-info-circle"></i> Popular data analysis tools in HEP</p>
</div>
<div class="panel-body docutils container">
<p>There are multiple packages that collaborators use in LHCb.
Some of this packages are CERN supported, some are projects from the LHCb collaborators and some are supported by external community.<br />This list is by no means exhaustive, so if there are any other tools you use often, please, feel free to add them by contributing to this lesson.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://root.cern/">ROOT</a> and its python twin sister pyROOT are open-source data analysis frameworks used extensively in HEP community.</p></li>
<li><p><a class="reference external" href="https://github.com/scikit-hep">Scikit-HEP project</a>, a community project for a Python-based Big Data analysis ecosystem for Particle Physics. Consists of multiple complementary and interoperable Python modules, some of them are listed here:</p>
<ul>
<li><p><a class="reference external" href="https://github.com/scikit-hep/uproot4">uproot</a> a python module that allows to read the root files (that are the output of the DaVinci package).</p></li>
<li><p><a class="reference external" href="https://github.com/scikit-hep/awkward-1.0">awkward-array</a> a Python module for a friendly manipulation of data structures common in Particle Physics, i.e., nested, variable-sized data, including arbitrary-length lists, records, mixed types, and missing data, using NumPy-like idioms.</p></li>
<li><p><a class="reference external" href="https://github.com/scikit-hep/boost-histogram">boost histogram</a> a python version of the C++14 library <a class="reference external" href="https://www.boost.org/doc/libs/1_77_0/libs/histogram/doc/html/index.html">Boost::Histogram</a> for histogramming.</p></li>
<li><p><a class="reference external" href="https://github.com/scikit-hep/iminuit">iminuit</a> a jupyter-friendly python interface for minimization package <a class="reference external" href="https://root.cern.ch/doc/master/Minuit2Page.html">Minuit2</a>.</p></li>
<li><p><a class="reference external" href="https://github.com/scikit-hep/mplhep">mplhep</a> a set of high energy physics helpers for <a class="reference external" href="https://matplotlib.org/">matplotlib</a>.</p></li>
<li><p>etc.</p></li>
</ul>
</li>
<li><p><a class="reference external" href="https://root.cern/manual/roofit/">RooFit</a> a fitting, fit model defining, plotting and “toy model” generation package supported by CERN ROOT team. Can be used in both C++ and python.</p></li>
<li><p><a class="reference external" href="https://github.com/zfit/zfit">zfit</a> a fitting and fit model defining Python package well integrated withthe <a class="reference external" href="https://github.com/scikit-hep">Scikit-HEP project</a> analysis ecosystem.</p></li>
</ul>
</div>
</div>
<p>Discussions on the new analysis tools that might be useful for the LHCb community are held in the <a class="reference external" href="https://lhcb-dpa.web.cern.ch/lhcb-dpa/wp4/index.html">Work Package 4</a> of the Data Processing &amp; Analysis project (DPA).</p>
</section>
<section id="analysis-preservation">
<h2>Analysis Preservation<a class="headerlink" href="#analysis-preservation" title="Link to this heading"></a></h2>
<p>When the samples are ready one can proceed with developing the necessary macros and scripts to perform the analysis steps, such as applying additional selections, fitting distributions, computing efficiencies and acceptances, etc.
Starting from the ntuples a typical analysis will consist of the following steps:</p>
<ol class="simple">
<li><p>Defining and applying selections, including kinematic, particle identification, multivariate analysis, signal/background separations by fitting.</p></li>
<li><p>Computing and applying callibrations and corrections.
Some of the calibrations, like <a class="reference external" href="https://gitlab.cern.ch/lhcb/Urania/tree/master/TrackCalib">TrackCalib</a> and <a class="reference external" href="https://gitlab.cern.ch/lhcb-rta/pidcalib2">PIDCalib2</a>, are calibrated centrally by collaborators and can be used by the users directly.
Other corrections, like correcting the kinematics distributions in the simulated samples to match the data ones as good as possible, are usually estimated on per analysis basis.</p></li>
<li><p>Computing efficiencies, acceptances and measuring detector resolution effects.</p></li>
<li><p>Putting all the above together to measure the parameter(s) of interest.</p></li>
</ol>
<p>After acquiring the parameter(s) of interest, one has to have their work being reviewed by <a class="reference external" href="https://twiki.cern.ch/twiki/bin/view/LHCbPhysics/LHCbPhysics">physics working group</a> (PWG) and then by the LHCb collaboration.</p>
<p>One of the requirements for the successful review is that your analysis code is preserved.<br />Scientific integrity means having transparency on each step of the research as well as reproducibility of the results.
Both LHCb and CERN have guidelines which one should always follow when conducting research usign LHCb or CERN facilities.
LHCb guidelines are discussed and implemented in the <a class="reference external" href="https://lhcb-dpa.web.cern.ch/lhcb-dpa/wp6/index.html">work package 6</a> of DPA.
CERN guideline can be found <a class="reference external" href="https://analysispreservation.cern.ch/login?next=/">here</a>.</p>
<p>The first step is to document well-used procedures, techniques and meticulously report the results of your analysis.
This is done by writing a clear and extensive Analysis Note, that is then available to the LHCb collaborators via the <a class="reference external" href="https://cds.cern.ch/collection/LHCb%20Analysis%20Notes">CDS system</a>.</p>
<p>Secondly, your analysis code should be put in a <a class="reference external" href="https://gitlab.cern.ch/">GitLab</a> repository in your physics working group’s area. For example, the code of all recent analyses by the QEE working group can be found <a class="reference external" href="https://gitlab.cern.ch/LHCb-QEE">here</a>.
GitLab is useful for tracing your own changes and changes of your collaborators too, as well as, tracing possible bugs with the GitLab CI.
Refer to <a class="reference external" href="https://hsf-training.github.io/analysis-essentials/git/README.html">this lesson on GitLab</a> for more.</p>
<p>However, it is not enough to just submit your code.
It is important to write a set of instructions to execute the steps in the correct sequence.
You will quickly find yourself, that remembering how to run your own code even a couple of months after it was used for the last time can be really hard.
Instructions can be written using <a class="reference external" href="https://snakemake.readthedocs.io/en/stable/">snakemake</a> and supportive bash scripts.</p>
<p>Snakemake workflow management system allows you to write a pipeline for analysis that will automatically detect the hierarchy of the steps and changes in inputs (both samples and code).
One should aim to start implementing the snakemake workflow from the beginning of analysis development.
Your snakemake workflow should then be committed to the gitlab repository with the final version of your code.</p>
<p>The samples you have produced should also be saved.
Analysis Productions help you to save a tested version of the DaVinci option files, that will help you to reproduce the ntuples with the same software version, that was specified in the original option files.</p>
<p>The ntuples used for your analysis have to be uploaded to the <a class="reference internal" href="eos-storage.html"><span class="doc">eos area</span></a> of your working group.</p>
<p>You should always preserve the package versions of the sofrware that you have being using.
Even if it is a commonly used tool such as ROOT or NumPy.
This can be done by creating a <a class="reference external" href="https://www.docker.com/">docker container</a>, <a class="reference external" href="https://github.com/conda-forge/miniforge/">conda enviroment</a> or using the <a class="reference external" href="https://gitlab.cern.ch/lhcb-core/lbcondawrappers/-/blob/master/README.md"><code class="docutils literal notranslate"><span class="pre">lb-conda</span></code> environment</a>.
The latter uses the conda environments installed on the <a class="reference external" href="https://cernvm.cern.ch/fs/">CERN virtual machine file system</a>, aka CVMFS, and is supported by the LHCb community.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="run-2-data-flow.html" class="btn btn-neutral float-left" title="Changes to the data flow in Run 2" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="davinci.html" class="btn btn-neutral float-right" title="An introduction to LHCb Software" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2015-2020, LHCb Starterkit.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
  <footer class="custom-footer" style="margin-top: 2em; padding-top: 1em; border-top: 1px solid #ccc; font-size: 0.9em; text-align: center;">
    <p>Note that this is the Starterkit for Runs 1 and 2. For Run 3, the software changed considerably and you can find its own dedicated Starterkit lessons <a href="https://lhcb-starterkit-run3.docs.cern.ch" target="_blank">here</a>.</p>
  </footer>

      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>