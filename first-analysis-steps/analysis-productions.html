

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Analysis Productions &mdash; LHCb Starterkit Lessons  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/panels.css?v=69fd799d" />
      <link rel="stylesheet" type="text/css" href="../_static/starterkit.css?v=be2937d8" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/panels.js?v=0f4bdeea"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Running DaVinci on the grid" href="davinci-grid.html" />
    <link rel="prev" title="How do I use DecayTreeFitter?" href="decay-tree-fitter.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            LHCb Starterkit Lessons
              <img src="../_static/starterkit.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="README.html">First Analysis Steps</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="prerequisites.html">Pre-workshop checklist</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction-to-course.html">Goals of the course</a></li>
<li class="toctree-l2"><a class="reference internal" href="physics-at-lhcb.html">Physics at LHCb</a><ul>
<li class="toctree-l3"><a class="reference internal" href="physics-at-lhcb.html#the-reconstruction">The reconstruction</a></li>
<li class="toctree-l3"><a class="reference internal" href="physics-at-lhcb.html#building-decay-candidates">Building decay candidates</a></li>
<li class="toctree-l3"><a class="reference internal" href="physics-at-lhcb.html#building-more-complex-decays">Building more complex decays</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="dataflow.html">The LHCb data flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="run-2-data-flow.html">Changes to the data flow in Run 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="analysisflow.html">The analysis flow and analysis preservation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="analysisflow.html#getting-data-files">Getting data files</a></li>
<li class="toctree-l3"><a class="reference internal" href="analysisflow.html#useful-high-energy-physics-analysis-tools">Useful high energy physics analysis tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="analysisflow.html#analysis-preservation">Analysis Preservation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="davinci.html">An introduction to LHCb Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="bookkeeping.html">Finding data in the Bookkeeping</a></li>
<li class="toctree-l2"><a class="reference internal" href="files-from-grid.html">Downloading a file from the grid</a></li>
<li class="toctree-l2"><a class="reference internal" href="interactive-dst.html">Interactively exploring a DST</a></li>
<li class="toctree-l2"><a class="reference internal" href="minimal-dv-job.html">Running a minimal DaVinci job locally</a></li>
<li class="toctree-l2"><a class="reference internal" href="loki-functors.html">Fun with LoKi Functors</a></li>
<li class="toctree-l2"><a class="reference internal" href="add-tupletools.html">TupleTools and branches</a></li>
<li class="toctree-l2"><a class="reference internal" href="decay-tree-fitter.html">How do I use DecayTreeFitter?</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Analysis Productions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#monitoring-productions">Monitoring productions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-your-own-production">Creating your own production</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#testing-your-production-locally">Testing your production locally</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-a-merge-request">Creating a merge request</a></li>
<li class="toctree-l4"><a class="reference internal" href="#analysis-productions-data">Analysis Productions Data</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="davinci-grid.html">Running DaVinci on the grid</a></li>
<li class="toctree-l2"><a class="reference internal" href="split-jobs.html">Splitting a job into subjobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="ganga-data.html">More Ganga</a></li>
<li class="toctree-l2"><a class="reference internal" href="eos-storage.html">Storing large files on EOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="lhcb-dev.html">Developing LHCb Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="dataflow-run3.html">LHCb data flow in Run 3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dataflow-run3.html#lhcb-upgrade">LHCb upgrade</a></li>
<li class="toctree-l3"><a class="reference internal" href="dataflow-run3.html#upgrade-of-the-lhcb-trigger-system">Upgrade of the LHCb trigger system</a><ul>
<li class="toctree-l4"><a class="reference internal" href="dataflow-run3.html#the-hlt-architecture">The HLT architecture</a></li>
<li class="toctree-l4"><a class="reference internal" href="dataflow-run3.html#selective-persistency">Selective persistency</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="dataflow-run3.html#offline-data-processing">Offline data processing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="dataflow-run3.html#changes-to-davinci">Changes to DaVinci</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="asking-questions.html">Asking good questions</a></li>
<li class="toctree-l2"><a class="reference internal" href="ecgd.html">Early career, gender and diversity</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing-lesson.html">Contribute to this lesson</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../second-analysis-steps/README.html">Second Analysis Steps</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/lb-git.html">Using git to develop LHCb software</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/building-decays.html">Building your own decay</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/building-decays-part0.html">The Selection Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/building-decays-part1.html">A Historical Approach</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/building-decays-part2.html">Modern Selection Framework</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/fixing-errors.html">What to do when something fails</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/rerun-stripping.html">Run a different stripping line on simulated data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/switch-mass-hypo.html">Replace a mass hypothesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/filter-in-trees.html">Reuse particles from a decay tree</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/simulation.html">The simulation framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-intro.html">What is Gauss?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-intro.html#choosing-your-gauss-version">Choosing your Gauss Version</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-running-gauss.html">Which option files to use and how to run Gauss</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-running-gauss.html#running-gauss-and-create-a-generator-only-sample">Running Gauss and create a generator-only sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-running-gauss.html#make-an-ntuple">Make an nTuple</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-dkfiles.html">Controlling the decay: DecFiles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-gencuts.html">Modifying the decay</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/simulation-gencuts.html#adding-a-decay-channel">Adding a decay channel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/simulation-gencuts.html#generator-level-cuts">Generator level cuts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/simulation-gencuts.html#removing-the-generator-cuts">Removing the generator cuts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/simulation-gencuts.html#modifying-the-cut-tool">Modifying the cut tool</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-advanced-dkfiles.html">Advanced: Modifying the decay</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-advanced-dkfiles.html#multi-body-decays">3+ multi-body decays</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-advanced-dkfiles.html#cocktail-decays">Cocktail decays</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-advanced-dkfiles.html#final-state-radiation">Final state radiation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-advanced-dkfiles.html#changing-particle-masses-lifetimes-widths">Changing particle masses / lifetimes/ widths</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-advanced-dkfiles.html#finding-constants-used-in-an-existing-mc-sample-masses-lifetimes-etc">Finding Constants Used in an Existing MC Sample (Masses/Lifetimes/etc)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/simulation-fastsim.html">Why fast simulation is crucial</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/simulation-fastsim.html#speeding-up-the-detector-simulation">Speeding up the detector simulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../second-analysis-steps/simulation-fastsim.html#speeding-up-the-generation">Speeding up the generation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/hlt-intro.html">HLT intro</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/hlt-intro.html#add-trigger-information-to-your-ntuple">Add trigger information to your ntuple</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/hlt-intro.html#exploring-a-tck-list-of-trigger-lines">Exploring a TCK: List of trigger lines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/hlt-intro.html#add-trigger-information-to-your-ntuple-continued">Add trigger information to your ntuple, continued</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/hlt-intro.html#add-tistos-information-to-your-ntuple">Add TISTOS information to your ntuple</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/hlt-intro.html#exploring-a-tck-properties-of-trigger-lines">Exploring a TCK: Properties of trigger lines</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/tistos-diy.html">TisTos DIY</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/ganga-scripting.html">Scripting Ganga</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/ganga-scripting.html#defining-jobs-with-scripts">Defining jobs with scripts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/ganga-scripting.html#adding-helpers-functions">Adding helpers functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/managing-files-with-ganga.html">Managing files in Ganga</a></li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/advanced-dirac.html">Advanced Dirac</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/advanced-dirac.html#gangatasks">GangaTasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/advanced-dirac.html#alternative-backends-dirac-python-bugged">Alternative Backends - DIRAC (Python bugged)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/advanced-dirac.html#alternative-backends-dirac-davinci">Alternative Backends - DIRAC (DaVinci)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../second-analysis-steps/advanced-dirac.html#alternative-backends-condor">Alternative Backends - Condor</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../second-analysis-steps/containers.html">Containers and running legacy code</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../self-guided-lessons/README.html">Self guided lessons</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../self-guided-lessons/htcondor.html">Batch submission using HTCondor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/htcondor-first-job.html">Submitting a simple job</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-first-job.html#tracking-your-jobs">Tracking your jobs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/htcondor-more-options.html">More submit file options</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-more-options.html#input-files">Input files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-more-options.html#output-files">Output files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-more-options.html#arguments">Arguments</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-more-options.html#resources-and-requirements">Resources and Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-more-options.html#notifications">Notifications</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/htcondor-queue.html">Using the queue command</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-queue.html#more-on-variables">More on variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-queue.html#other-ways-to-queue">Other ways to queue</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/htcondor-queue.html#mixing-options-and-variables">Mixing options and variables</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/htcondor.html#system-architecture">System architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/htcondor.html#other-useful-resources">Other useful resources</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html">Creating a grid proxy without LbScripts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#installation">Installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#macos-with-homebrew">macOS with homebrew</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#ubuntu">Ubuntu</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#centos">CentOS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#arch-linux">Arch Linux</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#getting-the-required-files-and-certificates">Getting the required files and certificates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#creating-a-proxy">Creating a proxy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../self-guided-lessons/local-grid-proxy.html#managing-the-proxy">Managing the proxy</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../CONTRIBUTING.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../CONTRIBUTING.html#dependencies">Dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../CONDUCT.html">Contributor Code of Conduct</a></li>
<li class="toctree-l3"><a class="reference internal" href="../LICENSE.html">Instructional Material</a></li>
<li class="toctree-l3"><a class="reference internal" href="../LICENSE.html#software">Software</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">External links:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://hsf-training.github.io/analysis-essentials/">Analysis essentials</a></li>
<li class="toctree-l1"><a class="reference external" href="https://cern.ch/lhcb-core-doc/">LHCb Core documentation</a></li>
<li class="toctree-l1"><a class="reference external" href="https://lhcb.github.io/glossary/">LHCb glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">LHCb Starterkit Lessons</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="README.html">First Analysis Steps</a></li>
      <li class="breadcrumb-item active">Analysis Productions</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/lhcb/starterkit-lessons/blob/master/first-analysis-steps/analysis-productions.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="analysis-productions">
<h1>Analysis Productions<a class="headerlink" href="#analysis-productions" title="Link to this heading"></a></h1>
<div class="panel panel-objectives docutils container">
<div class="panel-header open docutils container">
<p id="learning-objectives"><i class="fa fa-line-chart"></i> Learning Objectives</p>
</div>
<div class="panel-body docutils container">
<ul class="simple">
<li><p>Understand the reasons to use Analysis Productions</p></li>
<li><p>Look at some pre-existing productions</p></li>
<li><p>Create your own production</p></li>
</ul>
</div>
</div>
<p>Running DaVinci locally can be great for testing an options file, but is rarely appropriate for creating the full set of ROOT ntuples needed for an analysis. Historically, people would submit their jobs to the grid: one can send off a large number of DaVinci jobs to be handled by batch computing resources (in certain cases, this is still useful - see the <a class="reference internal" href="davinci-grid.html"><span class="doc">next lesson</span></a> for how to do this). However, this still has some drawbacks, in particular:</p>
<ul class="simple">
<li><p>Large datasets (especially in run 3) would require a long period of monitoring your grid jobs.</p></li>
<li><p>Computing resources can be wasted if multiple analyses are independently producing similar ntuples.</p></li>
<li><p>Ntuples can be lost, or removed when analysts leave, which can be an issue for <a class="reference external" href="https://lhcb-dpa.web.cern.ch/lhcb-dpa/wp6/index.html">analysis preservation</a>.</p></li>
</ul>
<p>It is the goal of <a class="reference external" href="https://gitlab.cern.ch/lhcb-datapkg/AnalysisProductions/">Analysis Productions</a> to centralise and automate much of the process of making ntuples, and to keep a record of how datasets were produced. In Run 3, this is the preferred way to create ntuples for your analysis.</p>
<section id="monitoring-productions">
<h2>Monitoring productions<a class="headerlink" href="#monitoring-productions" title="Link to this heading"></a></h2>
<p>Before we get into the how-to, let’s first take a look at the end result of a real production. Open the <a class="reference external" href="https://lhcb-analysis-productions.web.cern.ch/">Analysis Productions webpage</a>, and navigate to <code class="docutils literal notranslate"><span class="pre">Productions</span></code>. You should see a new menu appear, showing a list of productions. Using the search bar on the right you can search for any production of interest, try <code class="docutils literal notranslate"><span class="pre">b02dkpi</span></code> for example. This should return one result and clicking on it should show you a table of jobs belonging to the production.</p>
<p>Each row in the table corresponds to a job belonging to this production, and displays:</p>
<ul class="simple">
<li><p>Its status (e.g. READY, ACTIVE)</p></li>
<li><p>Its name (e.g. 2018_15164022_magup)</p></li>
<li><p>Some of its tags (e.g. MC/DATA, Run1/Run2)</p></li>
<li><p>When it needs a housekeeping check, when it was created and when it was last updated</p></li>
<li><p>The version of the Analysis Productions repository it corresponds to</p></li>
</ul>
<p>To view more information about any one of these jobs, you can click on it to view a job summary page. The image below shows one such page, with a couple of particularly useful elements highlighted in magenta.</p>
<p><img alt="An AP job summary" src="../_images/web_production_annotated.png" /></p>
<p>The top section shows a summary of important information, such as the state of the job, its production version, the total storage required for the output files and the merge request used to submit the production. To view the input scripts used to set up the production click the link to the merge request. The next section lists the DIRAC production information for the job. Finally, is the Production Output section which lists the output files for the job. One can use either the PFNs or LFNs to access the output, the PFNs should be visible to all systems with access to the CVMFS.</p>
<p>Let’s try accessing one of these files right now by doing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root<span class="w"> </span>-l<span class="w"> </span>root://eoslhcb.cern.ch//eos/lhcb/grid/prod/lhcb/LHCb/Collision12/B02DKPI.ROOT/00121782/0000/00121782_00000004_1.b02dkpi.root
</pre></div>
</div>
<p>You can now explore this file by doing <code class="docutils literal notranslate"><span class="pre">TBrowser</span> <span class="pre">b</span></code> inside of ROOT (or with another method of your choice).</p>
</section>
<section id="creating-your-own-production">
<h2>Creating your own production<a class="headerlink" href="#creating-your-own-production" title="Link to this heading"></a></h2>
<p>For practice, we will now go through the steps of creating a simple production. For details about more advanced usage, see the <a class="reference external" href="https://lhcb-ap.docs.cern.ch/index.html">Analysis Productions documentation</a>.</p>
<p>Start by creating a folder to work in, and into it clone the <a class="reference external" href="https://gitlab.cern.ch/lhcb-datapkg/AnalysisProductions">Analysis Productions repository</a>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>ssh://git@gitlab.cern.ch:7999/lhcb-datapkg/AnalysisProductions.git
<span class="nb">cd</span><span class="w"> </span>AnalysisProductions
</pre></div>
</div>
<p>Before making any edits, you should create a branch for your changes, and switch to it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>checkout<span class="w"> </span>-b<span class="w"> </span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span>/starterkit-practice
</pre></div>
</div>
<p>Now we need to create a folder to store all the things we’re going to add for our new production. For this practice production, we’ll continue with the <span class="math notranslate nohighlight">\(` B^+ \to (J/\psi \to \mu^+ \mu^-) K^+ `\)</span> decays used in the previous few lessons, so we should name the folder appropriately:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>starterkit
</pre></div>
</div>
<p>Let’s enter that new directory (<code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">starterkit</span></code>), and start adding the files we’ll need. First is the DaVinci options file. If you have the options file you created during the previous lessons in a working condition, copy it here, and open it with your text editor of choice.</p>
<p>If you don’t have your options file from earlier available, or are having trouble, you can <a class="reference download internal" download="" href="../_downloads/c64e8c69c2133646af1587bad0ce3466/dv_basic.py"><code class="xref download docutils literal notranslate"><span class="pre">use</span> <span class="pre">this</span> <span class="pre">options</span> <span class="pre">file</span></code></a>.</p>
<p>The next file needed is a <code class="docutils literal notranslate"><span class="pre">.yaml</span></code> file, which will be used to configure the jobs. Create a new file named <code class="docutils literal notranslate"><span class="pre">info.yaml</span></code>, and add the following to it:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">defaults</span><span class="p">:</span>
<span class="w">  </span><span class="nt">application</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DaVinci/v64r12</span>
<span class="w">  </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATA.ROOT</span>
<span class="w">  </span><span class="nt">options</span><span class="p">:</span>
<span class="w">    </span><span class="nt">entrypoint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">starterkit.dv_basic:main</span>
<span class="w">    </span><span class="nt">extra_options</span><span class="p">:</span>
<span class="w">      </span><span class="nt">input_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ROOT</span><span class="w"> </span>
<span class="w">      </span><span class="nt">input_raw_format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>
<span class="w">      </span><span class="nt">simulation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">      </span><span class="nt">input_process</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TurboPass&quot;</span>
<span class="w">      </span><span class="nt">geometry_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">run3/2024.Q1.2-v00.00</span>
<span class="w">      </span><span class="nt">conditions_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master</span>
<span class="w">      </span><span class="nt">lumi</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">data_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Upgrade&quot;</span>
<span class="w">      </span><span class="nt">input_stream</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">b2cc</span>
<span class="w">  </span><span class="nt">inform</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aidan.richard.wiederhold@cern.ch</span>
<span class="w">  </span><span class="nt">wg</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">B2CC</span>

<span class="nt">Bu2JpsiK_24c4_MagDown</span><span class="p">:</span>
<span class="w">  </span><span class="nt">input</span><span class="p">:</span>
<span class="w">    </span><span class="nt">bk_query</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/LHCb/Collision24/Beam6800GeV-VeloClosed-MagDown/Real</span><span class="nv"> </span><span class="s">Data/Sprucing24c4/94000000/B2CC.DST&quot;</span>
</pre></div>
</div>
<p>Here, the unindented lines are the names of jobs (although <code class="docutils literal notranslate"><span class="pre">defaults</span></code> has a special function), and the indented lines are the options we’re applying to those jobs. Using this file will create one job called <code class="docutils literal notranslate"><span class="pre">Bu2JpsiK_24c4_MagDown</span></code>, that will read in data from the provided bookkeeping path. All the options applied under <code class="docutils literal notranslate"><span class="pre">defaults</span></code> are automatically applied to all other jobs - very useful for avoiding repetition. The options we’re using here are copied from the Run 3 DaVinci lesson:</p>
<ul class="simple">
<li><p><strong>application</strong>: the version of DaVinci to use. Here we choose v64r12, see <a class="reference external" href="http://lhcbdoc.web.cern.ch/lhcbdoc/davinci/">here</a> to check what versions are available.</p></li>
<li><p><strong>wg</strong>: the working group this production is a part of. Since this is a <span class="math notranslate nohighlight">\(` B^+ \to (J/\psi \to \mu^+ \mu^-) K^+ `\)</span> decay, we’ll set this to <code class="docutils literal notranslate"><span class="pre">B2CC</span></code>.</p></li>
<li><p><strong>inform</strong>: optionally, you can enter your email address to receive updates on the status of your jobs.</p></li>
<li><p><strong>options</strong>: the settings to use when running DaVinci. These are copied from the Run 3 DaVinci lesson.</p></li>
<li><p><strong>output</strong>: the name of the output <code class="docutils literal notranslate"><span class="pre">.root</span></code> ntuples. These will get registered in bookkeeping as well.</p></li>
<li><p><strong>input</strong>: the bookkeeping path of the data you’re running over. This is what you located during the <a class="reference internal" href="bookkeeping.html"><span class="doc">bookkeeping lesson</span></a>, and is unique to the 24c4 magnet down job, so it doesn’t belong under <code class="docutils literal notranslate"><span class="pre">defaults</span></code>.</p></li>
</ul>
<p>For a full list of the available options, and information on their allowed values, see the <a class="reference external" href="https://lhcb-ap.docs.cern.ch/user_guide/creating.html#yaml-configuration">documentation</a>.</p>
<div class="panel panel-challenge docutils container">
<div class="panel-header open docutils container">
<p id="add-a-magnet-up-job"><i class="fa fa-square-o"></i> Add a magnet-up job</p>
</div>
<div class="panel-body docutils container">
<p>Currently, this will create ntuples for 24c4 magnet-down data only. See if you can add to your <code class="docutils literal notranslate"><span class="pre">info.yaml</span></code> file to create a job for 24c4 magnet-up data as well. <em>Hint:</em> the location of the correct <code class="docutils literal notranslate"><span class="pre">.DST</span></code> file can be found using bookkeeping.</p>
<div class="panel panel-solution docutils container">
<div class="panel-header docutils container">
<p id="solutions"><i class="fa fa-check-square-o"></i> Solutions</p>
</div>
<div class="panel-body docutils container">
<p>Since we’re making use of the <code class="docutils literal notranslate"><span class="pre">defaults</span></code> job name, we need to add very little to add this new job. One can simply copy the final 3 lines to create a new job, rename it to <code class="docutils literal notranslate"><span class="pre">Bu2JpsiK_24c4_MagUp</span></code>, and add the appropriate bookkeeping path. An example of this can be found <a class="reference download internal" download="" href="../_downloads/27028a16a46572fec57089b46a40fd04/info.yaml"><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a>.</p>
</div>
</div>
</div>
</div>
<p>For good practice, the final thing we should add is a README. This is a markdown file that will be used to document the information about your production in a more human-readable format. Create a file <code class="docutils literal notranslate"><span class="pre">README.md</span></code>, and add some pertinent information. If you’re not sure what to add, try looking at some existing productions to get an idea.</p>
<section id="testing-your-production-locally">
<h3>Testing your production locally<a class="headerlink" href="#testing-your-production-locally" title="Link to this heading"></a></h3>
<p>Now we’ve got both of the files we need, we should test the production to make sure it works as expected. All of this will be done using the <code class="docutils literal notranslate"><span class="pre">lb-ap</span></code> command. Navigate up one level to the base directory of the repository (<code class="docutils literal notranslate"><span class="pre">AnalysisProductions</span></code>), and run <code class="docutils literal notranslate"><span class="pre">lb-ap</span></code>, which should display the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Usage: lb-ap [OPTIONS] COMMAND [ARGS]...

  Command line tool for the LHCb AnalysisProductions

Options:
  --version
  --help     Show this message and exit.

Commands:
  login        Login to the Analysis Productions API
  versions     List the available tags of the Analysis Productions...
  clone        Clone the AnalysisProductions repository and do lb-ap...
  checkout     Clean out the current copy of the specified production and...
  list         List the available production folders by running &#39;lb-ap list&#39;
  list-checks  List the checks for a specific production by running lb-ap...
  render       Render the info.yaml for a given production
  validate     Validate the configuration for a given production
  test         Execute a job locally
  check        Run checks for a production
  ci-checks    Helper function for running checks in the CI.
  debug        Start an interactive session inside the job&#39;s environment
  reproduce    Reproduce an existing online test locally
  parse-log    Read a Gaudi log file and extract information
</pre></div>
</div>
<p>This command <code class="docutils literal notranslate"><span class="pre">lb-ap</span></code> will allow us to perform a number of different tests. Let’s start with <code class="docutils literal notranslate"><span class="pre">lb-ap</span> <span class="pre">list</span></code>, which will display all of the productions. Hopefully you should see your new production (<code class="docutils literal notranslate"><span class="pre">starterkit</span></code>) on this list! You can also use this to list all of the jobs within a given production, by running <code class="docutils literal notranslate"><span class="pre">lb-ap</span> <span class="pre">list</span> <span class="pre">starterkit</span></code>. If you added a second job for magnet-up earlier, the output of this command should look like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>The available jobs for starterkit are: 
* Bu2JpsiK_24c4_MagDown
* Bu2JpsiK_24c4_MagUp
</pre></div>
</div>
<p>The most important test is if the production actually runs successfully, and creates the desired ntuples. The <code class="docutils literal notranslate"><span class="pre">lb-ap</span></code> command is used for this as well. To test the magnet-down job, run this command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>lb-ap<span class="w"> </span><span class="nb">test</span><span class="w"> </span>starterkit<span class="w"> </span>Bu2JpsiK_24c4_MagDown
</pre></div>
</div>
<p>The first time you run this in a session remember to activate your proxy using <code class="docutils literal notranslate"><span class="pre">lhcb-proxy-init</span></code>. You will also be prompted to sign into the CERN Single Sign-On as an extra security step.</p>
<p>DaVinci will now run using the data and options files you specified in <code class="docutils literal notranslate"><span class="pre">info.yaml</span></code>. You should see the output from DaVinci similar to what you saw when you ran it manually in an earlier lesson, followed by a completion message that tells you the location of the output files created by the test.</p>
<p>You should find that a <code class="docutils literal notranslate"><span class="pre">local-tests</span></code> directory has been created, and inside it are a record of any local tests you’ve run. Navigate to the <code class="docutils literal notranslate"><span class="pre">output</span></code> folder of your test, and check what files have been created. There are assorted log files, as well as a <code class="docutils literal notranslate"><span class="pre">.ROOT</span></code> file called something like <code class="docutils literal notranslate"><span class="pre">00012345_00006789_1.DATA.ROOT</span></code>.</p>
<p>Let’s open this <code class="docutils literal notranslate"><span class="pre">.root</span></code> file and check if everything worked correctly. Similar to what we did earlier, run <code class="docutils literal notranslate"><span class="pre">root</span> <span class="pre">-l</span> <span class="pre">00012345_00006789_1.DATA.ROOT</span></code> to open ROOT with that ntuple loaded, and view the contents by running <code class="docutils literal notranslate"><span class="pre">TBrowser</span> <span class="pre">b</span></code> (or otherwise). Take a little time to look around, and make sure everything’s in order.</p>
<div class="panel panel-callout docutils container">
<div class="panel-header open docutils container">
<p id="useful-resources"><i class="fa fa-info-circle"></i> Useful resources</p>
</div>
<div class="panel-body docutils container">
<p>If you encounter problems while creating a real production, here are a few good places to ask for help:</p>
<p>For issues with options files, try the <a class="reference external" href="https://mattermost.web.cern.ch/lhcb/channels/davinci">DaVinci Mattermost channel</a> or the <a class="reference external" href="mailto:lhcb-davinci&#37;&#52;&#48;cern&#46;ch">lhcb-davinci mailing list</a></p>
<p>For issues with <code class="docutils literal notranslate"><span class="pre">info.yaml</span></code> files, or anything else to do with the Analysis Productions framework, try the <a class="reference external" href="https://mattermost.web.cern.ch/lhcb/channels/dpa-wp2-analysis-productions">Analysis Productions Mattermost channel</a>, or contact the Analysis Productions coordinator(s) (see <a class="reference external" href="http://lhcb-dpa.web.cern.ch/lhcb-dpa/">here</a> to find out who they are).</p>
</div>
</div>
</section>
<section id="creating-a-merge-request">
<h3>Creating a merge request<a class="headerlink" href="#creating-a-merge-request" title="Link to this heading"></a></h3>
<p>Now that we’ve tested all of our changes and are sure that everything’s working as intended, we can prepare to submit them to the main repository by creating a merge request. Start by commiting the changes:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>add<span class="w"> </span>dv_basic.py
git<span class="w"> </span>add<span class="w"> </span>info.yaml
git<span class="w"> </span>add<span class="w"> </span>README.md
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Add starterkit example production&quot;</span>
</pre></div>
</div>
<p>And then push the changes with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>push<span class="w"> </span>origin<span class="w"> </span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span>/starterkit-practice
</pre></div>
</div>
<p>Once this has completed, it should give you a link to create a merge request for your new branch. Open it in a browser, and give it a suitable name &amp; description - also please add the <code class="docutils literal notranslate"><span class="pre">Starterkit</span> <span class="pre">(not</span> <span class="pre">for</span> <span class="pre">merge)</span></code> label! For a real production please ensure you follow the instructions in the merge request description template. Then you can submit your merge request.</p>
<p>Since this is only for practice, your request won’t actually be merged, but some tests will still be run automatically. To view these, go to the Pipelines tab of your merge request, and open it by clicking the pipeline number (eg. “#1958388”). At the bottom, you will see a <code class="docutils literal notranslate"><span class="pre">test</span></code> job - click on this, and it will show you the output of the test jobs. These will take a little time to complete, so it may still be in progress. The first few lines should look something like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Running with gitlab_runner_api 0.1.dev42+g457dbd5
INFO:Creating new pipeline for ID 1958388
ALWAYS:Results will be available at https://lhcb-analysis-productions.web.cern.ch/1958388/
</pre></div>
</div>
<p>You can open that link in your browser to view the status of the test jobs (example <a class="reference external" href="https://lhcb-analysis-productions.web.cern.ch/ana-prod/pipelines/?id=8610&amp;ci_run=starterkit">here</a>). After a few minutes, these should have completed - all being well, you’ve now successfully prepared your first production!</p>
</section>
<section id="analysis-productions-data">
<h3>Analysis Productions Data<a class="headerlink" href="#analysis-productions-data" title="Link to this heading"></a></h3>
<p>We have created a standalone Python package, <a class="reference external" href="https://pypi.org/project/apd/">APD</a>, which can be used to help you access your Analysis Productions output.
At the bottom of a job output page you can find an example of how to do this.
For this starterkit example we could do</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>from<span class="w"> </span>apd<span class="w"> </span>import<span class="w"> </span>AnalysisData
<span class="nv">datasets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>AnalysisData<span class="o">(</span><span class="s2">&quot;apd&quot;</span>,<span class="w"> </span><span class="s2">&quot;starterkit&quot;</span><span class="o">)</span>
<span class="nv">24c4_magdown_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>datasets<span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;bu2jpsik_24c4_magdown&quot;</span><span class="o">)</span>
</pre></div>
</div>
<p>This will create <code class="docutils literal notranslate"><span class="pre">24c4_magdown_data</span></code> as a list of all the PFNs for the output of this job. You could then access these using your preferred kind of Python based ROOT.</p>
<div class="panel panel-callout docutils container">
<div class="panel-header open docutils container">
<p id="next-steps-for-real-productions"><i class="fa fa-info-circle"></i> Next steps for real productions</p>
</div>
<div class="panel-body docutils container">
<p>As mentioned earlier, your test productions for this lesson won’t be merged since this is only for practice purposes. If this were a real production, there would be some extra steps to take before merging.</p>
<p>You should try to reach out to anyone else who may also want to use these ntuples, and see if they’d like to add or change anything. This is usually done through your working group (either by email, or for new productions, by presenting at a WG meeting). For this, you can start by getting in touch with your WG conveners (see <a class="reference external" href="http://lhcb.web.cern.ch/lhcb_page/collaboration/organization/lhcb-conv/Physics_history_and_Sub-structure.html">here</a> to find out who they are).</p>
<p>In addition, the Analysis Productions coordinator(s) may also have some feedback on your additions/changes.</p>
</div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="decay-tree-fitter.html" class="btn btn-neutral float-left" title="How do I use DecayTreeFitter?" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="davinci-grid.html" class="btn btn-neutral float-right" title="Running DaVinci on the grid" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2015-2020, LHCb Starterkit.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>